{"id":"agent-ops-0fl","title":"Phase 1: Data Layer","description":"Implement the foundational data layer including Zod models, Drizzle ORM schema, and repository pattern for data access.","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-20T22:43:44.995199-06:00","updated_at":"2025-12-21T13:06:25.056901-06:00","closed_at":"2025-12-21T13:06:25.056901-06:00","close_reason":"Closed","labels":["backend","foundation"]}
{"id":"agent-ops-0fl.1","title":"Implement WorkItem Zod model","description":"Create src/models/work-item.ts with WorkItemType, WorkItemStatus, Transition, SuccessCriterion, and WorkItem Zod schemas as specified in design doc.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:44:31.844652-06:00","updated_at":"2025-12-21T13:06:04.38415-06:00","closed_at":"2025-12-21T13:06:04.38415-06:00","close_reason":"Closed","labels":["backend","models"],"dependencies":[{"issue_id":"agent-ops-0fl.1","depends_on_id":"agent-ops-0fl","type":"parent-child","created_at":"2025-12-20T22:44:31.847385-06:00","created_by":"daemon"}]}
{"id":"agent-ops-0fl.2","title":"Implement AgentTemplate Zod model","description":"Create src/models/template.ts with AgentRole, PermissionMode, MCPServerConfig, and AgentTemplate Zod schemas as specified in design doc.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:44:32.939365-06:00","updated_at":"2025-12-21T13:06:04.650032-06:00","closed_at":"2025-12-21T13:06:04.650032-06:00","close_reason":"Closed","labels":["backend","models"],"dependencies":[{"issue_id":"agent-ops-0fl.2","depends_on_id":"agent-ops-0fl","type":"parent-child","created_at":"2025-12-20T22:44:32.943105-06:00","created_by":"daemon"}]}
{"id":"agent-ops-0fl.3","title":"Implement AgentWorker Zod model","description":"Create src/models/worker.ts with WorkerStatus, AgentWorker schemas and WorkerPool interface as specified in design doc.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:44:34.577329-06:00","updated_at":"2025-12-21T13:06:04.902113-06:00","closed_at":"2025-12-21T13:06:04.902113-06:00","close_reason":"Closed","labels":["backend","models"],"dependencies":[{"issue_id":"agent-ops-0fl.3","depends_on_id":"agent-ops-0fl","type":"parent-child","created_at":"2025-12-20T22:44:34.58005-06:00","created_by":"daemon"}]}
{"id":"agent-ops-0fl.4","title":"Implement Trace model","description":"Create src/models/trace.ts with schema for observability events including tool calls, state changes, and metrics.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:44:36.612065-06:00","updated_at":"2025-12-21T13:06:15.24823-06:00","closed_at":"2025-12-21T13:06:15.24823-06:00","close_reason":"Closed","labels":["backend","models"],"dependencies":[{"issue_id":"agent-ops-0fl.4","depends_on_id":"agent-ops-0fl","type":"parent-child","created_at":"2025-12-20T22:44:36.614698-06:00","created_by":"daemon"}]}
{"id":"agent-ops-0fl.5","title":"Setup Drizzle ORM schema","description":"Create src/db/schema.ts with Drizzle table definitions for work_items, templates, workers, and traces. Configure SQLite with better-sqlite3.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-20T22:44:37.591417-06:00","updated_at":"2025-12-20T22:58:56.366139-06:00","closed_at":"2025-12-20T22:58:56.366139-06:00","close_reason":"Closed","labels":["backend","database"],"dependencies":[{"issue_id":"agent-ops-0fl.5","depends_on_id":"agent-ops-0fl","type":"parent-child","created_at":"2025-12-20T22:44:37.593846-06:00","created_by":"daemon"}]}
{"id":"agent-ops-0fl.6","title":"Create database migrations","description":"Setup Drizzle migrations in src/db/migrations/ with initial schema migration.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:44:38.812214-06:00","updated_at":"2025-12-21T13:06:15.491097-06:00","closed_at":"2025-12-21T13:06:15.491097-06:00","close_reason":"Closed","labels":["backend","database"],"dependencies":[{"issue_id":"agent-ops-0fl.6","depends_on_id":"agent-ops-0fl","type":"parent-child","created_at":"2025-12-20T22:44:38.815641-06:00","created_by":"daemon"}]}
{"id":"agent-ops-0fl.7","title":"Implement WorkItem repository","description":"Create src/repositories/work-item.repository.ts with CRUD operations and query methods for work items.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:44:40.054139-06:00","updated_at":"2025-12-21T13:06:15.71092-06:00","closed_at":"2025-12-21T13:06:15.71092-06:00","close_reason":"Closed","labels":["backend","repository"],"dependencies":[{"issue_id":"agent-ops-0fl.7","depends_on_id":"agent-ops-0fl","type":"parent-child","created_at":"2025-12-20T22:44:40.056984-06:00","created_by":"daemon"}]}
{"id":"agent-ops-0fl.8","title":"Implement Template repository","description":"Create src/repositories/template.repository.ts with CRUD operations for agent templates.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:44:41.374567-06:00","updated_at":"2025-12-21T13:06:24.605731-06:00","closed_at":"2025-12-21T13:06:24.605731-06:00","close_reason":"Closed","labels":["backend","repository"],"dependencies":[{"issue_id":"agent-ops-0fl.8","depends_on_id":"agent-ops-0fl","type":"parent-child","created_at":"2025-12-20T22:44:41.378819-06:00","created_by":"daemon"}]}
{"id":"agent-ops-0fl.9","title":"Implement Worker repository","description":"Create src/repositories/worker.repository.ts with CRUD operations for agent workers.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:44:42.468284-06:00","updated_at":"2025-12-21T13:06:24.833897-06:00","closed_at":"2025-12-21T13:06:24.833897-06:00","close_reason":"Closed","labels":["backend","repository"],"dependencies":[{"issue_id":"agent-ops-0fl.9","depends_on_id":"agent-ops-0fl","type":"parent-child","created_at":"2025-12-20T22:44:42.472686-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4ka","title":"Local Agent Dashboard MVP","description":"Build a local web dashboard to orchestrate Claude agents in Docker containers on Mac.\n\n**MVP Scope:**\n- Run Claude agents in Docker containers (ARM64)\n- Web dashboard showing active agents\n- Real-time log streaming (SSE)\n- Terminal view per agent (xterm.js)\n- Start/stop agent controls\n- Works with existing bd workflow\n\n**Out of Scope (for now):**\n- Cloud deployment\n- Multi-tenant/auth\n- gVisor/Firecracker (Docker is fine locally)\n- Multiple repos (start with current repo)\n\n**Target:** Mac M3 Pro, macOS, Docker Desktop","design":"# Implementation Plan: Local Agent Dashboard MVP with Docker Container Orchestration\n\n## Overview\n\nBuild a local web dashboard to orchestrate Claude agents running in Docker containers on Mac M3 Pro (ARM64). This plan implements real-time visibility into agent execution via SSE log streaming, WebSocket terminal access, and container lifecycle management, integrating seamlessly with the existing agent-ops codebase.\n\n## FACTS Validation Summary\n\n- **Feasibility**: All tasks use proven technologies (Dockerode, better-sse, xterm.js) with Node.js 20+ support. Mac ARM64 compatibility confirmed. Docker Desktop socket access is standard.\n- **Atomicity**: Each task represents a single testable unit of work (one test file, one method, one component). Tasks are ordered to allow immediate verification.\n- **Clarity**: Tasks include specific file paths, method signatures, and test case descriptions. Developers can proceed without ambiguity.\n- **Testability**: TDD approach with Red-Green-Refactor cycle. Every implementation task is preceded by a test task. Integration and E2E tests included.\n- **Scope**: Four phases with clear milestones. Each phase represents a committable state with working functionality.\n\n## Prerequisites\n\n### Dependencies to Install\n\n**Backend** (run in `/Users/probinson/Repos/on-par/saas/agent-ops/backend`):\n```bash\nnpm install dockerode better-sse ws\nnpm install -D @types/dockerode @types/ws\n```\n\n**Frontend** (run in `/Users/probinson/Repos/on-par/saas/agent-ops/frontend`):\n```bash\nnpm install @xterm/xterm @xterm/addon-attach @xterm/addon-fit\n```\n\nNote: TanStack Query (`@tanstack/react-query@5.90.12`) is already installed in the frontend.\n\n### Environment Setup\n\n1. Docker Desktop must be installed and running on macOS\n2. Verify Docker socket is accessible: `ls -la /var/run/docker.sock`\n3. Ensure sufficient disk space for container images (~2GB recommended)\n\n### Blocking Issues\n\nNone identified. All dependencies are publicly available and compatible with the existing stack.\n\n---\n\n## Phase 1: Database \u0026 Core Services (Foundation)\n\n**Goal**: Establish the data layer and container management service with full test coverage.\n\n**Committable State**: Database schema extended with containers table, ContainerRepository functional, ContainerManagerService passing all unit tests with mocked Dockerode.\n\n### Tasks\n\n- [ ] **1.1** Add container status enum and containers table to `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/shared/db/schema.ts`\n  - Add `containerStatuses` const array: `['creating', 'running', 'stopped', 'error', 'removing']`\n  - Add `ContainerStatus` type\n  - Add `containers` sqliteTable with fields: `id`, `containerId`, `workspaceId`, `workerId`, `executionId`, `image`, `status`, `name`, `createdAt`, `startedAt`, `stoppedAt`\n  - Add type exports: `Container`, `NewContainer`\n\n- [ ] **1.2** Run database migration to create containers table\n  - Execute `npm run db:generate` followed by `npm run db:push`\n  - Verify table creation with `npm run db:studio`\n\n- [ ] [P] **1.3** Create container repository directory structure\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/containers/` directory\n  - Create subdirectories: `repositories/`, `services/`, `handler/`, `tests/`\n\n- [ ] **1.4** Write test: ContainerRepository CRUD operations (expect fail)\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/containers/tests/container.repository.test.ts`\n  - Test cases:\n    - `create()` inserts container record and returns it\n    - `findById()` returns container or null\n    - `findByWorkspaceId()` returns array of containers\n    - `findByStatus()` filters by status correctly\n    - `updateStatus()` updates status and sets appropriate timestamps\n    - `delete()` removes container record\n\n- [ ] **1.5** Implement ContainerRepository (expect pass)\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/containers/repositories/container.repository.ts`\n  - Follow pattern from `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/agent-runtime/repositories/agent-execution.repository.ts`\n  - Methods: `create()`, `findById()`, `findByWorkspaceId()`, `findByWorkerId()`, `findByStatus()`, `updateStatus()`, `update()`, `delete()`\n\n- [ ] **1.6** Write test: ContainerManagerService container lifecycle (expect fail)\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/containers/tests/container-manager.service.test.ts`\n  - Mock Dockerode with vitest\n  - Test cases:\n    - `createContainer()` creates Docker container with correct config (image, mounts, env, resource limits)\n    - `createContainer()` saves container record to database\n    - `startContainer()` starts Docker container and updates status to 'running'\n    - `stopContainer()` stops Docker container gracefully and updates status\n    - `removeContainer()` removes Docker container and deletes database record\n    - `getContainerLogs()` returns readable stream from container\n    - `execInContainer()` executes command and returns stream for PTY\n    - Error handling: `createContainer()` with invalid image throws descriptive error\n    - Error handling: `startContainer()` with non-existent container throws error\n\n- [ ] **1.7** Implement ContainerManagerService (expect pass)\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/containers/services/container-manager.service.ts`\n  - Constructor accepts: `db: DrizzleDatabase`, `dockerClient?: Docker` (for injection/mocking)\n  - Methods:\n    - `createContainer(config: ContainerConfig): Promise\u003cContainer\u003e`\n    - `startContainer(containerId: string): Promise\u003cvoid\u003e`\n    - `stopContainer(containerId: string, timeout?: number): Promise\u003cvoid\u003e`\n    - `removeContainer(containerId: string): Promise\u003cvoid\u003e`\n    - `getContainerLogs(containerId: string, options?: LogOptions): Promise\u003cNodeJS.ReadableStream\u003e`\n    - `execInContainer(containerId: string, cmd: string[]): Promise\u003cExecStream\u003e`\n    - `getContainerStatus(containerId: string): Promise\u003cContainerStatus\u003e`\n  - Default Docker client connects to `/var/run/docker.sock`\n\n- [ ] **1.8** Write test: ContainerManagerService resource limits (expect fail)\n  - Add test cases to existing test file:\n    - `createContainer()` applies memory limit correctly\n    - `createContainer()` applies CPU limit correctly\n    - `createContainer()` mounts workspace volume at correct path\n\n- [ ] **1.9** Implement resource limit configuration (expect pass)\n  - Extend `ContainerConfig` interface with:\n    - `memoryLimit: number` (bytes, default 512MB)\n    - `cpuLimit: number` (NanoCPUs, default 1 core)\n    - `workspacePath: string`\n    - `workspaceMount: string` (default `/workspace`)\n  - Update `createContainer()` to set `HostConfig.Memory`, `HostConfig.NanoCpus`, `HostConfig.Binds`\n\n- [ ] **1.10** Refactor: Extract Docker configuration to config file\n  - Add to `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/shared/config.ts`:\n    - `dockerSocketPath: string` (default `/var/run/docker.sock`)\n    - `dockerAgentImage: string` (default `agent-ops/agent:latest`)\n    - `containerMemoryLimit: number` (default 512MB)\n    - `containerCpuLimit: number` (default 1 CPU)\n  - Update ContainerManagerService to use config\n\n---\n\n## Phase 2: API Layer (Backend Integration)\n\n**Goal**: Expose container management via REST API with SSE log streaming and WebSocket terminal access.\n\n**Committable State**: Full REST API for container CRUD, SSE endpoint streaming container logs, WebSocket endpoint providing terminal access. All endpoints tested with integration tests.\n\n### Tasks\n\n- [ ] **2.1** Write test: Container handler REST endpoints (expect fail)\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/containers/tests/container.handler.test.ts`\n  - Use Fastify inject for HTTP testing\n  - Test cases:\n    - `POST /api/containers` creates container with valid config, returns 201\n    - `POST /api/containers` with invalid config returns 400 with Zod errors\n    - `GET /api/containers` returns array of containers\n    - `GET /api/containers?status=running` filters by status\n    - `GET /api/containers/:id` returns container or 404\n    - `POST /api/containers/:id/start` starts container, returns 200\n    - `POST /api/containers/:id/start` on running container returns 409\n    - `POST /api/containers/:id/stop` stops container, returns 200\n    - `DELETE /api/containers/:id` removes container, returns 200\n    - `DELETE /api/containers/:id` on non-existent returns 404\n\n- [ ] **2.2** Implement Container handler REST endpoints (expect pass)\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/containers/handler/container.handler.ts`\n  - Follow pattern from `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/agent-runtime/handler/agent-runtime.handler.ts`\n  - Create Zod schemas for request validation:\n    - `CreateContainerSchema`: name, image, workspaceId, memoryLimit?, cpuLimit?\n  - Implement routes:\n    - `POST /` - Create container\n    - `GET /` - List containers (optional status filter)\n    - `GET /:id` - Get container details\n    - `POST /:id/start` - Start container\n    - `POST /:id/stop` - Stop container\n    - `DELETE /:id` - Remove container\n\n- [ ] **2.3** Register container routes in app\n  - Update `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/app.ts`\n  - Import `containerHandler` from containers feature\n  - Register with prefix `/api/containers`\n\n- [ ] **2.4** Write test: SSE log streaming endpoint (expect fail)\n  - Add test cases to container.handler.test.ts:\n    - `GET /api/containers/:id/logs` returns SSE stream with correct headers\n    - `GET /api/containers/:id/logs` streams stdout and stderr events\n    - `GET /api/containers/:id/logs?follow=true` keeps connection open\n    - `GET /api/containers/:id/logs` on non-existent container returns 404\n\n- [ ] **2.5** Implement SSE log streaming endpoint (expect pass)\n  - Add to container.handler.ts:\n    - `GET /:id/logs` - SSE endpoint using better-sse\n  - Use `createSession()` from better-sse\n  - Get log stream from ContainerManagerService.getContainerLogs()\n  - Demux stdout/stderr using Dockerode modem.demuxStream\n  - Broadcast events with type 'stdout' or 'stderr'\n  - Handle client disconnect gracefully\n\n- [ ] **2.6** Write test: WebSocket terminal endpoint (expect fail)\n  - Add test file: `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/containers/tests/container-terminal.test.ts`\n  - Test cases:\n    - WebSocket connection to `/api/containers/:id/terminal` succeeds\n    - Terminal data from container is sent to client\n    - Client input is sent to container\n    - Connection closes when container stops\n    - Invalid container ID closes connection with error\n\n- [ ] **2.7** Implement WebSocket terminal endpoint (expect pass)\n  - Add WebSocket route to container.handler.ts:\n    - `GET /:id/terminal` - WebSocket endpoint\n  - Use @fastify/websocket (already installed)\n  - On connection:\n    - Create exec session with PTY (Tty: true, AttachStdin/Stdout/Stderr: true)\n    - Start exec with hijack mode\n    - Pipe WebSocket messages to exec stream\n    - Pipe exec stream output to WebSocket\n  - Handle disconnection cleanup\n\n- [ ] **2.8** Write test: Agent executor containerized execution (expect fail)\n  - Update `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/agent-runtime/tests/agent-executor.service.test.ts`\n  - Add test cases:\n    - `execute()` with `containerized: true` creates container with workspace\n    - `execute()` with `containerized: true` starts container and runs agent inside\n    - `execute()` with `containerized: true` collects output from container\n    - `execute()` with `containerized: true` cleans up container on success\n    - `execute()` with `containerized: true` cleans up container on error\n    - `execute()` without `containerized` flag uses existing in-process execution (backward compatible)\n\n- [ ] **2.9** Implement containerized execution in AgentExecutorService (expect pass)\n  - Update `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/agent-runtime/services/agent-executor.service.ts`\n  - Add optional `containerized?: boolean` to ExecutionContext\n  - Inject ContainerManagerService dependency\n  - When containerized=true:\n    1. Create container with workspace mounted\n    2. Start container\n    3. Execute agent via docker exec (run CLI inside container)\n    4. Stream output back\n    5. Stop and remove container on completion\n\n- [ ] **2.10** Write integration test: Full container lifecycle (expect fail)\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/containers/tests/container.integration.test.ts`\n  - Requires real Docker (skip if Docker not available)\n  - Test cases:\n    - Create → Start → Get logs → Stop → Remove workflow succeeds\n    - Container status updates reflect actual Docker state\n    - Workspace files are accessible from within container\n\n- [ ] **2.11** Implement integration test fixes (expect pass)\n  - Fix any issues discovered in integration testing\n  - Ensure proper cleanup on test failure\n\n---\n\n## Phase 3: Frontend Integration (UI Components)\n\n**Goal**: Build React components for container visualization with real-time updates.\n\n**Committable State**: Dashboard displays active containers in cards, logs stream in real-time via SSE, terminal provides interactive access. Components integrated with existing navigation.\n\n### Tasks\n\n- [ ] [P] **3.1** Create container API hooks with TanStack Query\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/hooks/use-containers.ts`\n  - Hooks:\n    - `useContainers(status?: ContainerStatus)` - List containers with optional filter, poll every 5s\n    - `useContainer(id: string)` - Single container details\n    - `useCreateContainer()` - Mutation hook\n    - `useStartContainer()` - Mutation hook\n    - `useStopContainer()` - Mutation hook\n    - `useRemoveContainer()` - Mutation hook\n  - Each mutation invalidates `['containers']` query on success\n\n- [ ] [P] **3.2** Create container types\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/types/container.ts`\n  - Define TypeScript interfaces matching backend schema:\n    - `Container`\n    - `ContainerStatus`\n    - `CreateContainerRequest`\n    - `ContainerLogEvent`\n\n- [ ] **3.3** Create ContainerCard component\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/components/containers/ContainerCard.tsx`\n  - Props: `container: Container`, `onStart`, `onStop`, `onRemove`, `onViewLogs`, `onOpenTerminal`\n  - Display: name, status badge (color-coded), image, created time, action buttons\n  - Use existing styling patterns from Dashboard.tsx (card-hover, badges, etc.)\n\n- [ ] **3.4** Create ContainerLogs component with SSE\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/components/containers/ContainerLogs.tsx`\n  - Props: `containerId: string`, `onClose: () =\u003e void`\n  - Use native EventSource API to connect to `/api/containers/:id/logs`\n  - Maintain log buffer (last 1000 lines) with auto-scroll\n  - Color-code stderr lines differently\n  - Include clear button and close button\n  - Handle reconnection on disconnect\n\n- [ ] **3.5** Install xterm.js CSS\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/styles/xterm.css`\n  - Import xterm base styles from `@xterm/xterm/css/xterm.css`\n  - Add custom styling for container terminal (background, font, etc.)\n\n- [ ] **3.6** Create ContainerTerminal component with xterm.js\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/components/containers/ContainerTerminal.tsx`\n  - Props: `containerId: string`, `onClose: () =\u003e void`\n  - Initialize xterm Terminal with:\n    - cursorBlink: true\n    - fontSize: 14\n    - fontFamily: 'Menlo, Monaco, \"Courier New\", monospace'\n    - theme matching dashboard dark theme\n  - Load FitAddon for responsive sizing\n  - Connect via WebSocket to `/api/containers/:id/terminal`\n  - Use AttachAddon to pipe WebSocket to terminal\n  - Handle resize events with fitAddon.fit()\n  - Cleanup on unmount\n\n- [ ] **3.7** Create ContainerList component\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/components/containers/ContainerList.tsx`\n  - Props: `containers: Container[]`, callbacks for actions\n  - Grid layout matching ActiveAgentsGrid pattern\n  - Empty state when no containers\n  - Loading skeleton while fetching\n\n- [ ] **3.8** Create Containers page\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/pages/Containers.tsx`\n  - Layout:\n    - Header with title \"Agent Containers\" and \"New Container\" button\n    - Status filter tabs: All, Running, Stopped, Error\n    - ContainerList component\n    - Modal/slide-over for logs view\n    - Modal/slide-over for terminal view\n  - Use useContainers hook for data\n  - Handle create, start, stop, remove actions\n\n- [ ] **3.9** Add Containers route to App\n  - Update `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/App.tsx`\n  - Add route: `\u003cRoute path=\"/containers\" element={\u003cContainers /\u003e} /\u003e`\n\n- [ ] **3.10** Add Containers link to navigation\n  - Update `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/components/Layout.tsx`\n  - Add navigation item for Containers page with appropriate icon (e.g., Box from lucide-react)\n\n- [ ] **3.11** Write frontend tests: Container components\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/components/containers/__tests__/ContainerCard.test.tsx`\n  - Test cases:\n    - Renders container name and status\n    - Calls onStart when start button clicked\n    - Calls onStop when stop button clicked\n    - Disables start button when container is running\n\n- [ ] **3.12** Write frontend tests: SSE log streaming\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/components/containers/__tests__/ContainerLogs.test.tsx`\n  - Mock EventSource\n  - Test cases:\n    - Connects to correct SSE endpoint\n    - Appends stdout messages to log buffer\n    - Appends stderr messages with error styling\n    - Closes EventSource on unmount\n\n---\n\n## Phase 4: Docker \u0026 Deployment (Containerization)\n\n**Goal**: Create production-ready Docker images for all components and orchestration via docker-compose.\n\n**Committable State**: Running `docker-compose up` starts the complete system - backend, frontend, and can spawn agent containers. Documentation complete for local deployment.\n\n### Tasks\n\n- [ ] **4.1** Create agent runtime Dockerfile\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/backend/Dockerfile.agent`\n  - Base: `node:20-slim`\n  - Install: git, curl (for health checks)\n  - Copy backend source and build\n  - Set working directory to /workspace\n  - Entry point: node dist/cli.js\n  - Health check: node -e \"process.exit(0)\"\n  - Labels for identification\n\n- [ ] **4.2** Create backend server Dockerfile\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/backend/Dockerfile`\n  - Multi-stage build:\n    - Stage 1: Build TypeScript\n    - Stage 2: Production runtime with only dist/ and node_modules\n  - Base: `node:20-slim`\n  - Expose port 3001\n  - Health check endpoint: /health\n  - Non-root user for security\n\n- [ ] **4.3** Create frontend Dockerfile\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/Dockerfile`\n  - Multi-stage build:\n    - Stage 1: Build Vite production bundle\n    - Stage 2: nginx:alpine serving static files\n  - Configure nginx for SPA routing (fallback to index.html)\n  - Expose port 80\n\n- [ ] **4.4** Create nginx configuration for frontend\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/nginx.conf`\n  - SPA fallback configuration\n  - Proxy /api requests to backend (optional, if same-origin needed)\n  - Gzip compression\n  - Cache headers for static assets\n\n- [ ] **4.5** Create docker-compose.yml\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/docker-compose.yml`\n  - Services:\n    - `backend`: Build from backend/Dockerfile, mount docker.sock, volume for database\n    - `frontend`: Build from frontend/Dockerfile, depends_on backend\n  - Networks: custom bridge network\n  - Volumes: sqlite data persistence\n  - Environment variables from .env file\n  - Port mappings: frontend:3000, backend:3001\n\n- [ ] **4.6** Create .env.example for Docker deployment\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/.env.example`\n  - Document all environment variables:\n    - PORT, HOST\n    - DATABASE_URL\n    - LLM_PROVIDER, LLM_MODEL, LLM_BASE_URL\n    - DOCKER_AGENT_IMAGE, DOCKER_SOCKET\n    - ANTHROPIC_API_KEY (optional)\n\n- [ ] **4.7** Create docker-compose.dev.yml for development\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/docker-compose.dev.yml`\n  - Extends base docker-compose.yml\n  - Add volume mounts for source code (hot reload)\n  - Add development-specific environment variables\n  - Include commented-out service for local Ollama\n\n- [ ] **4.8** Write E2E test: Full container workflow\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/e2e/container-workflow.test.ts`\n  - Requires Docker (skip if not available)\n  - Test scenario:\n    1. Start backend and frontend via docker-compose\n    2. Create container via API\n    3. Start container\n    4. Connect to SSE logs, verify streaming works\n    5. Connect to WebSocket terminal, send command, verify output\n    6. Stop container\n    7. Remove container\n    8. Verify cleanup\n\n- [ ] **4.9** Build and verify agent image\n  - Run: `docker build -f backend/Dockerfile.agent -t agent-ops/agent:latest .`\n  - Test: `docker run --rm agent-ops/agent:latest node dist/cli.js --help`\n  - Verify ARM64 compatibility on Mac M3\n\n- [ ] **4.10** Create deployment documentation\n  - Create `/Users/probinson/Repos/on-par/saas/agent-ops/docs/local-deployment.md`\n  - Sections:\n    - Prerequisites (Docker Desktop, Node.js)\n    - Quick start (docker-compose up)\n    - Configuration options\n    - Troubleshooting common issues\n    - Architecture diagram\n    - Security considerations\n\n- [ ] **4.11** Update project README with container features\n  - Update `/Users/probinson/Repos/on-par/saas/agent-ops/README.md`\n  - Add section on Docker container orchestration\n  - Link to detailed deployment docs\n  - Update feature list\n\n---\n\n## Validation Checklist\n\nAfter completing all phases, verify:\n\n- [ ] All unit tests passing: `cd backend \u0026\u0026 npm test`\n- [ ] All frontend tests passing: `cd frontend \u0026\u0026 npm test`\n- [ ] Integration tests passing with real Docker\n- [ ] E2E test passing with docker-compose\n- [ ] `docker-compose up` starts the complete system without errors\n- [ ] Dashboard displays running containers\n- [ ] Log streaming works in browser (SSE connection established, logs appear)\n- [ ] Terminal works in browser (WebSocket connected, can type commands)\n- [ ] Container start/stop/remove operations work from UI\n- [ ] bd workflow still works (existing functionality not broken)\n- [ ] CLI runner still works (existing functionality not broken)\n- [ ] Documentation complete and accurate\n\n---\n\n## Appendix: Code Examples\n\n### A. Container Repository Pattern\n\nReference: `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/agent-runtime/repositories/agent-execution.repository.ts`\n\n```typescript\n// Pattern for container.repository.ts\nimport { eq } from \"drizzle-orm\";\nimport type { DrizzleDatabase } from \"../../../shared/db/index.js\";\nimport {\n  containers,\n  type Container,\n  type NewContainer,\n  type ContainerStatus,\n} from \"../../../shared/db/schema.js\";\n\nexport class ContainerRepository {\n  constructor(private db: DrizzleDatabase) {}\n\n  async create(container: NewContainer): Promise\u003cContainer\u003e {\n    const [created] = await this.db\n      .insert(containers)\n      .values(container)\n      .returning();\n    if (!created) throw new Error(\"Failed to create container\");\n    return created;\n  }\n\n  async findById(id: string): Promise\u003cContainer | null\u003e {\n    const [container] = await this.db\n      .select()\n      .from(containers)\n      .where(eq(containers.id, id))\n      .limit(1);\n    return container || null;\n  }\n\n  async updateStatus(id: string, status: ContainerStatus): Promise\u003cContainer\u003e {\n    const updates: Partial\u003cContainer\u003e = { status };\n    if (status === \"running\") updates.startedAt = new Date();\n    if (status === \"stopped\") updates.stoppedAt = new Date();\n    \n    const [updated] = await this.db\n      .update(containers)\n      .set(updates)\n      .where(eq(containers.id, id))\n      .returning();\n    if (!updated) throw new Error(`Container ${id} not found`);\n    return updated;\n  }\n}\n```\n\n### B. Dockerode Usage Pattern\n\n```typescript\n// Pattern for container-manager.service.ts\nimport Docker from \"dockerode\";\n\nexport class ContainerManagerService {\n  private docker: Docker;\n  private repository: ContainerRepository;\n\n  constructor(db: DrizzleDatabase, dockerClient?: Docker) {\n    this.repository = new ContainerRepository(db);\n    this.docker = dockerClient ?? new Docker({ socketPath: \"/var/run/docker.sock\" });\n  }\n\n  async createContainer(config: ContainerConfig): Promise\u003cContainer\u003e {\n    const dockerContainer = await this.docker.createContainer({\n      Image: config.image,\n      name: config.name,\n      Env: config.env,\n      HostConfig: {\n        Memory: config.memoryLimit ?? 512 * 1024 * 1024,\n        NanoCpus: config.cpuLimit ?? 1_000_000_000,\n        Binds: [`${config.workspacePath}:${config.workspaceMount}:rw`],\n      },\n    });\n\n    return await this.repository.create({\n      id: uuidv4(),\n      containerId: dockerContainer.id,\n      workspaceId: config.workspaceId,\n      image: config.image,\n      name: config.name,\n      status: \"creating\",\n      createdAt: new Date(),\n    });\n  }\n\n  async getContainerLogs(containerId: string): Promise\u003cNodeJS.ReadableStream\u003e {\n    const record = await this.repository.findById(containerId);\n    if (!record) throw new Error(`Container ${containerId} not found`);\n    \n    const container = this.docker.getContainer(record.containerId);\n    return await container.logs({\n      follow: true,\n      stdout: true,\n      stderr: true,\n      timestamps: true,\n    });\n  }\n}\n```\n\n### C. SSE Endpoint Pattern\n\nReference: better-sse documentation\n\n```typescript\n// Pattern for container log SSE endpoint\nimport { createSession } from \"better-sse\";\n\napp.get(\"/:id/logs\", async (request, reply) =\u003e {\n  const { id } = request.params as { id: string };\n  \n  const container = await containerManager.getContainerById(id);\n  if (!container) {\n    reply.status(404).send({ error: \"Container not found\" });\n    return;\n  }\n\n  // Create SSE session\n  const session = await createSession(request.raw, reply.raw);\n  \n  // Get log stream\n  const logStream = await containerManager.getContainerLogs(id);\n  \n  // Demux and broadcast\n  const docker = new Docker();\n  docker.modem.demuxStream(\n    logStream,\n    {\n      write: (chunk: Buffer) =\u003e {\n        session.push(chunk.toString().trim(), \"stdout\");\n      },\n    },\n    {\n      write: (chunk: Buffer) =\u003e {\n        session.push(chunk.toString().trim(), \"stderr\");\n      },\n    }\n  );\n\n  // Cleanup on disconnect\n  request.raw.on(\"close\", () =\u003e {\n    logStream.destroy();\n  });\n});\n```\n\n### D. TanStack Query Hook Pattern\n\nReference: Existing usage in codebase\n\n```typescript\n// Pattern for use-containers.ts\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { API_BASE } from \"../lib/api\";\nimport type { Container, ContainerStatus } from \"../types/container\";\n\nexport function useContainers(status?: ContainerStatus) {\n  return useQuery({\n    queryKey: [\"containers\", status],\n    queryFn: async () =\u003e {\n      const url = status\n        ? `${API_BASE}/api/containers?status=${status}`\n        : `${API_BASE}/api/containers`;\n      const response = await fetch(url);\n      if (!response.ok) throw new Error(\"Failed to fetch containers\");\n      return response.json() as Promise\u003cContainer[]\u003e;\n    },\n    refetchInterval: 5000,\n  });\n}\n\nexport function useStartContainer() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (containerId: string) =\u003e {\n      const response = await fetch(\n        `${API_BASE}/api/containers/${containerId}/start`,\n        { method: \"POST\" }\n      );\n      if (!response.ok) throw new Error(\"Failed to start container\");\n      return response.json();\n    },\n    onSuccess: () =\u003e {\n      queryClient.invalidateQueries({ queryKey: [\"containers\"] });\n    },\n  });\n}\n```\n\n### E. xterm.js Integration Pattern\n\nReference: xterm.js documentation\n\n```typescript\n// Pattern for ContainerTerminal.tsx\nimport { useEffect, useRef } from \"react\";\nimport { Terminal } from \"@xterm/xterm\";\nimport { AttachAddon } from \"@xterm/addon-attach\";\nimport { FitAddon } from \"@xterm/addon-fit\";\nimport \"@xterm/xterm/css/xterm.css\";\n\ninterface ContainerTerminalProps {\n  containerId: string;\n  onClose: () =\u003e void;\n}\n\nexport function ContainerTerminal({ containerId, onClose }: ContainerTerminalProps) {\n  const terminalRef = useRef\u003cHTMLDivElement\u003e(null);\n  const termRef = useRef\u003cTerminal | null\u003e(null);\n  const wsRef = useRef\u003cWebSocket | null\u003e(null);\n\n  useEffect(() =\u003e {\n    if (!terminalRef.current) return;\n\n    // Create terminal\n    const terminal = new Terminal({\n      cursorBlink: true,\n      fontSize: 14,\n      fontFamily: 'Menlo, Monaco, \"Courier New\", monospace',\n      theme: {\n        background: \"#0a0a0f\",\n        foreground: \"#e4e4e7\",\n        cursor: \"#22d3ee\",\n      },\n    });\n\n    const fitAddon = new FitAddon();\n    terminal.loadAddon(fitAddon);\n    terminal.open(terminalRef.current);\n    fitAddon.fit();\n\n    // Connect WebSocket\n    const wsUrl = `ws://localhost:3001/api/containers/${containerId}/terminal`;\n    const ws = new WebSocket(wsUrl);\n    const attachAddon = new AttachAddon(ws);\n    terminal.loadAddon(attachAddon);\n\n    termRef.current = terminal;\n    wsRef.current = ws;\n\n    // Handle resize\n    const handleResize = () =\u003e fitAddon.fit();\n    window.addEventListener(\"resize\", handleResize);\n\n    return () =\u003e {\n      window.removeEventListener(\"resize\", handleResize);\n      ws.close();\n      terminal.dispose();\n    };\n  }, [containerId]);\n\n  return (\n    \u003cdiv className=\"flex flex-col h-full\"\u003e\n      \u003cdiv className=\"flex justify-between items-center p-2 bg-[var(--bg-card)]\"\u003e\n        \u003cspan className=\"text-sm font-medium\"\u003eTerminal\u003c/span\u003e\n        \u003cbutton onClick={onClose} className=\"text-[var(--text-muted)] hover:text-white\"\u003e\n          Close\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \u003cdiv ref={terminalRef} className=\"flex-1\" /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## File Reference Summary\n\n### New Files to Create\n\n**Backend:**\n- `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/containers/repositories/container.repository.ts`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/containers/services/container-manager.service.ts`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/containers/handler/container.handler.ts`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/containers/tests/container.repository.test.ts`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/containers/tests/container-manager.service.test.ts`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/containers/tests/container.handler.test.ts`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/containers/tests/container-terminal.test.ts`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/containers/tests/container.integration.test.ts`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/backend/Dockerfile`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/backend/Dockerfile.agent`\n\n**Frontend:**\n- `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/hooks/use-containers.ts`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/types/container.ts`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/components/containers/ContainerCard.tsx`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/components/containers/ContainerLogs.tsx`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/components/containers/ContainerTerminal.tsx`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/components/containers/ContainerList.tsx`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/pages/Containers.tsx`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/styles/xterm.css`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/Dockerfile`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/nginx.conf`\n\n**Root:**\n- `/Users/probinson/Repos/on-par/saas/agent-ops/docker-compose.yml`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/docker-compose.dev.yml`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/.env.example`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/docs/local-deployment.md`\n- `/Users/probinson/Repos/on-par/saas/agent-ops/e2e/container-workflow.test.ts`\n\n### Existing Files to Modify\n\n- `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/shared/db/schema.ts` (add containers table)\n- `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/shared/config.ts` (add Docker config)\n- `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/app.ts` (register container routes)\n- `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/agent-runtime/services/agent-executor.service.ts` (add containerized execution)\n- `/Users/probinson/Repos/on-par/saas/agent-ops/backend/src/features/agent-runtime/tests/agent-executor.service.test.ts` (add containerized tests)\n- `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/App.tsx` (add Containers route)\n- `/Users/probinson/Repos/on-par/saas/agent-ops/frontend/src/components/Layout.tsx` (add navigation link)\n- `/Users/probinson/Repos/on-par/saas/agent-ops/README.md` (update with container features)","status":"in_progress","priority":1,"issue_type":"epic","created_at":"2025-12-24T10:27:58.780235-06:00","updated_at":"2025-12-24T15:02:11.442761-06:00","comments":[{"id":1,"issue_id":"agent-ops-4ka","author":"probinson","text":"# Research: Local Agent Dashboard MVP\n\n**Issue**: agent-ops-4ka\n**Date**: 2025-12-24\n**Status**: Research Complete\n\n---\n\n## 1. Problem Overview\n\n### Problem Statement\nBuild a local web dashboard to orchestrate Claude agents running in Docker containers on Mac M3 Pro (ARM64). The dashboard should provide real-time visibility into agent execution, streaming logs, terminal access, and lifecycle management while integrating with the existing agent-ops codebase.\n\n### Key Objectives\n\n1. **Container Isolation**: Run agents in Docker containers for security, resource control, and reproducibility\n2. **Real-time Monitoring**: Stream logs and status updates from running agents to the dashboard\n3. **Interactive Control**: Start, stop, and interact with agents via web UI and REST API\n4. **Mac ARM64 Support**: Full compatibility with Docker Desktop on macOS with Apple Silicon\n5. **Integration**: Seamlessly integrate with existing agent-runtime, workspace management, and bd workflow\n\n### Success Criteria\n\n- ✅ Agents execute in isolated Docker containers with resource limits\n- ✅ Dashboard displays active agents with real-time status updates\n- ✅ Logs stream in real-time via Server-Sent Events (SSE)\n- ✅ Terminal view per agent using xterm.js for interactive access\n- ✅ Start/stop controls work reliably\n- ✅ Works with existing CLI runner and bd issue tracking\n- ✅ No degradation of existing in-process execution performance\n- ✅ Complete test coverage for container lifecycle management\n\n---\n\n## 2. Web Research Findings\n\n### Recommended Technology Stack\n\n#### Backend Technologies\n\n##### 1. Docker Management: Dockerode\n**Library**: `dockerode@4.0.2`\n**Purpose**: Node.js client for Docker Remote API\n\n**Why Chosen**:\n- Most mature Docker SDK for Node.js (12M+ weekly downloads)\n- Excellent stream handling with built-in demultiplexing support\n- Comprehensive API coverage matching Docker Remote API\n- Works seamlessly on Mac ARM64 with Docker Desktop\n- Both callback and promise interfaces available\n\n**Key Features**:\n```typescript\nimport Docker from 'dockerode';\n\nconst docker = new Docker({ socketPath: '/var/run/docker.sock' });\n\n// Create and start a container\nconst container = await docker.createContainer({\n  Image: 'claude-agent:latest',\n  Cmd: ['node', 'agent.js'],\n  name: 'agent-1',\n  Env: ['ANTHROPIC_API_KEY=sk-...'],\n  HostConfig: {\n    Memory: 512 * 1024 * 1024, // 512MB\n    NanoCpus: 1000000000, // 1 CPU core\n  }\n});\n\nawait container.start();\n\n// Stream logs with demultiplexing\nconst stream = await container.attach({\n  stream: true,\n  stdout: true,\n  stderr: true\n});\n\ncontainer.modem.demuxStream(stream, process.stdout, process.stderr);\n```\n\n**Documentation**:\n- [Dockerode GitHub](https://github.com/apocas/dockerode)\n- [Dockerode npm](https://www.npmjs.com/package/dockerode)\n\n##### 2. Log Streaming: better-sse\n**Library**: `better-sse@0.13.0`\n**Purpose**: Server-Sent Events (SSE) for real-time log streaming\n\n**Why Chosen**:\n- SSE experiencing resurgence in 2025 for AI streaming applications\n- Simpler than WebSockets for one-way server-to-client communication\n- Native browser support with EventSource API\n- Automatic reconnection built into browser\n- TypeScript-native with zero dependencies\n- HTTP-based, works through proxies and firewalls\n\n**Key Features**:\n```typescript\nimport express from 'express';\nimport { createSession, createChannel } from 'better-sse';\nimport Docker from 'dockerode';\n\nconst app = express();\nconst docker = new Docker({ socketPath: '/var/run/docker.sock' });\nconst logChannels = new Map\u003cstring, any\u003e();\n\n// SSE endpoint for container logs\napp.get('/api/containers/:id/logs', async (req, res) =\u003e {\n  const session = await createSession(req, res);\n  const containerId = req.params.id;\n\n  let channel = logChannels.get(containerId);\n  if (!channel) {\n    channel = createChannel();\n    logChannels.set(containerId, channel);\n\n    const container = docker.getContainer(containerId);\n    const logStream = await container.logs({\n      follow: true,\n      stdout: true,\n      stderr: true,\n      timestamps: true\n    });\n\n    container.modem.demuxStream(\n      logStream,\n      { write: (chunk: Buffer) =\u003e channel.broadcast(chunk.toString(), 'stdout') },\n      { write: (chunk: Buffer) =\u003e channel.broadcast(chunk.toString(), 'stderr') }\n    );\n  }\n\n  channel.register(session);\n\n  session.state.on('disconnected', () =\u003e {\n    channel.deregister(session);\n  });\n});\n```\n\n**Frontend Integration**:\n```typescript\nimport { useEffect, useState } from 'react';\n\nfunction ContainerLogs({ containerId }: { containerId: string }) {\n  const [logs, setLogs] = useState\u003cstring[]\u003e([]);\n\n  useEffect(() =\u003e {\n    const eventSource = new EventSource(`/api/containers/${containerId}/logs`);\n\n    eventSource.addEventListener('stdout', (event) =\u003e {\n      setLogs(prev =\u003e [...prev, event.data]);\n    });\n\n    eventSource.addEventListener('stderr', (event) =\u003e {\n      setLogs(prev =\u003e [...prev, `[ERROR] ${event.data}`]);\n    });\n\n    return () =\u003e eventSource.close();\n  }, [containerId]);\n\n  return (\n    \u003cdiv className=\"logs\"\u003e\n      {logs.map((log, i) =\u003e \u003cdiv key={i}\u003e{log}\u003c/div\u003e)}\n    \u003c/div\u003e\n  );\n}\n```\n\n**Documentation**:\n- [better-sse GitHub](https://github.com/MatthewWid/better-sse)\n- [Real-time Log Streaming with SSE](https://dev.to/manojspace/real-time-log-streaming-with-nodejs-and-react-using-server-sent-events-sse-48pk)\n\n##### 3. Terminal Access: WebSocket + xterm.js\n**Library**: `ws@8.18.0` (WebSocket) + `@xterm/xterm@5.5.0` (Terminal)\n**Purpose**: Interactive browser-based terminal for containers\n\n**Why Chosen**:\n- Industry standard (used by Portainer, Selenoid UI)\n- Full terminal emulation with VT100/xterm compatibility\n- Interactive command execution in containers\n- No SSH server needed in containers\n- Rich add-on ecosystem (fit, search, weblinks, etc.)\n\n**Backend Implementation**:\n```typescript\nimport { WebSocketServer } from 'ws';\nimport Docker from 'dockerode';\n\nconst docker = new Docker({ socketPath: '/var/run/docker.sock' });\nconst wss = new WebSocketServer({ server });\n\nwss.on('connection', (ws, req) =\u003e {\n  const containerId = new URL(req.url!, 'ws://localhost').searchParams.get('container');\n\n  if (!containerId) {\n    ws.close();\n    return;\n  }\n\n  const container = docker.getContainer(containerId);\n\n  container.exec({\n    Cmd: ['bash'],\n    AttachStdin: true,\n    AttachStdout: true,\n    AttachStderr: true,\n    Tty: true\n  }).then(exec =\u003e {\n    return exec.start({\n      hijack: true,\n      stdin: true,\n      Tty: true\n    });\n  }).then(stream =\u003e {\n    ws.on('message', (msg) =\u003e stream.write(msg));\n    stream.on('data', (chunk: Buffer) =\u003e ws.send(chunk));\n    ws.on('close', () =\u003e stream.end());\n  });\n});\n```\n\n**Frontend Implementation**:\n```typescript\nimport { useEffect, useRef } from 'react';\nimport { Terminal } from '@xterm/xterm';\nimport { AttachAddon } from '@xterm/addon-attach';\nimport { FitAddon } from '@xterm/addon-fit';\nimport '@xterm/xterm/css/xterm.css';\n\nfunction ContainerTerminal({ containerId }: { containerId: string }) {\n  const terminalRef = useRef\u003cHTMLDivElement\u003e(null);\n\n  useEffect(() =\u003e {\n    if (!terminalRef.current) return;\n\n    const terminal = new Terminal({\n      cursorBlink: true,\n      fontSize: 14,\n      fontFamily: 'Menlo, Monaco, \"Courier New\", monospace'\n    });\n\n    const fitAddon = new FitAddon();\n    terminal.loadAddon(fitAddon);\n    terminal.open(terminalRef.current);\n    fitAddon.fit();\n\n    const ws = new WebSocket(`ws://localhost:3000?container=${containerId}`);\n    const attachAddon = new AttachAddon(ws);\n    terminal.loadAddon(attachAddon);\n\n    return () =\u003e {\n      ws.close();\n      terminal.dispose();\n    };\n  }, [containerId]);\n\n  return \u003cdiv ref={terminalRef} className=\"terminal-container\" /\u003e;\n}\n```\n\n**Documentation**:\n- [xterm.js Official Site](https://xtermjs.org/)\n- [Building Browser Terminal with Docker and XtermJS](https://www.presidio.com/technical-blog/building-a-browser-based-terminal-using-docker-and-xtermjs/)\n\n##### 4. API Validation: Zod\n**Library**: `zod@3.24.1`\n**Purpose**: Type-safe runtime validation with compile-time type inference\n\n**Why Chosen**:\n- Type safety from API to database with single schema definition\n- Runtime validation catches invalid data\n- Excellent TypeScript integration with type inference\n- Clear, structured error responses\n\n**Implementation**:\n```typescript\nimport { z } from 'zod';\n\nconst CreateAgentSchema = z.object({\n  name: z.string().min(1).max(50),\n  image: z.string().default('claude-agent:latest'),\n  memory: z.number().min(128).max(2048).default(512),\n  cpus: z.number().min(0.5).max(4).default(1),\n});\n\ntype CreateAgentInput = z.infer\u003ctypeof CreateAgentSchema\u003e;\n\nfunction validate\u003cT extends z.ZodType\u003e(schema: T) {\n  return (req: express.Request, res: express.Response, next: express.NextFunction) =\u003e {\n    const result = schema.safeParse(req.body);\n\n    if (!result.success) {\n      return res.status(400).json({\n        error: 'Validation failed',\n        details: result.error.issues.map(issue =\u003e ({\n          path: issue.path.join('.'),\n          message: issue.message,\n        })),\n      });\n    }\n\n    req.body = result.data;\n    next();\n  };\n}\n\napp.post('/api/agents', validate(CreateAgentSchema), async (req, res) =\u003e {\n  const input: CreateAgentInput = req.body;\n  // ... create agent\n});\n```\n\n**Documentation**:\n- [Building bulletproof ExpressJS APIs with Zod](https://blog.oscars.dev/posts/building-bulletproof-expressjs-apis-with-zod/)\n\n##### 5. Logging: Pino\n**Library**: `pino@9.7.0`\n**Purpose**: High-performance JSON logger for Node.js\n\n**Why Chosen**:\n- 5-10x faster than Winston\n- JSON-first structured logging\n- Asynchronous, non-blocking\n- Excellent for Docker environments\n- Already in use in the codebase\n\n**Implementation**:\n```typescript\nimport pino from 'pino';\n\nconst logger = pino({\n  level: process.env.NODE_ENV === 'production' ? 'info' : 'debug',\n  transport: process.env.NODE_ENV === 'development'\n    ? { target: 'pino-pretty' }\n    : undefined,\n});\n\nlogger.info({ containerId: 'abc123', event: 'started' }, 'Agent container started');\n```\n\n**Documentation**:\n- [Pino Logger: Complete Node.js Guide [2025]](https://signoz.io/guides/pino-logger/)\n\n#### Frontend Technologies\n\n##### 1. Build Tool: Vite\n**Version**: `7.2.0` (already in use)\n**Purpose**: Fast development experience with HMR\n\n**Why Chosen**:\n- Already in the codebase\n- Instant HMR and fast builds\n- Excellent TypeScript support\n- Native ESM support\n\n##### 2. UI Framework: React 18 + TypeScript\n**Version**: `19.2.0` (already in use)\n**Purpose**: Component-based UI development\n\n**Why Chosen**:\n- Already in the codebase\n- Mature ecosystem\n- Excellent TypeScript integration\n- Large community and resources\n\n##### 3. Component Library: shadcn/ui\n**Purpose**: Beautiful, accessible UI components\n\n**Why Chosen**:\n- Modern, customizable components\n- Tailwind CSS integration (already in use)\n- Accessibility built-in\n- Copy-paste components (no bloat)\n- 2025 best practice for admin dashboards\n\n**Usage**:\n```bash\nnpx shadcn-ui@latest add card button badge\n```\n\n**Documentation**:\n- [shadcn/ui](https://ui.shadcn.com/)\n- [shadcn-admin GitHub](https://github.com/rohitsoni007/shadcn-admin)\n\n##### 4. State Management: TanStack Query\n**Library**: `@tanstack/react-query@5.62.21`\n**Purpose**: Server state management with caching and auto-refetching\n\n**Why Chosen**:\n- Perfect for server state and caching\n- Automatic cache invalidation and refetching\n- Optimistic updates\n- Background refetching\n- Industry standard for 2025\n\n**Implementation**:\n```typescript\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\n\nexport function useAgents() {\n  const queryClient = useQueryClient();\n\n  const { data: agents, isLoading } = useQuery({\n    queryKey: ['agents'],\n    queryFn: async () =\u003e {\n      const { data } = await axios.get\u003cAgent[]\u003e('/api/agents');\n      return data;\n    },\n    refetchInterval: 5000, // Poll every 5 seconds\n  });\n\n  const startAgent = useMutation({\n    mutationFn: async (agentId: string) =\u003e {\n      const { data } = await axios.post(`/api/agents/${agentId}/start`);\n      return data;\n    },\n    onSuccess: () =\u003e {\n      queryClient.invalidateQueries({ queryKey: ['agents'] });\n    },\n  });\n\n  return { agents, isLoading, startAgent: startAgent.mutate };\n}\n```\n\n**Documentation**:\n- [TanStack Query Docs](https://tanstack.com/query/latest)\n\n### Best Practices and Patterns\n\n#### Docker Security for Local Deployment\n\n**Localhost Binding**:\n```typescript\n// Configure Docker Desktop to bind ports to 127.0.0.1 only\nconst containerConfig = {\n  HostConfig: {\n    PortBindings: {\n      '3000/tcp': [{ HostIp: '127.0.0.1', HostPort: '3000' }]\n    }\n  }\n};\n```\n\n**Resource Limits**:\n```typescript\nconst containerConfig = {\n  HostConfig: {\n    Memory: 512 * 1024 * 1024, // 512MB hard limit\n    MemoryReservation: 256 * 1024 * 1024, // 256MB soft limit\n    NanoCpus: 1000000000, // 1 CPU core\n    CpusetCpus: '0', // Pin to specific CPU core if needed\n  }\n};\n```\n\n**Secrets Management**:\n- Use Docker secrets or file-based mounts instead of environment variables\n- Never commit secrets to version control\n\n**Network Isolation**:\n- Use custom bridge networks to segment containers\n- Limit external network access\n\n**Documentation**:\n- [Docker Security 2025](https://www.onlinehashcrack.com/guides/best-practices/docker-security-2025-hardening-containers.php)\n- [Docker Secrets in Compose](https://docs.docker.com/compose/how-tos/use-secrets/)\n\n#### Health Checks and Monitoring\n\n**Dockerfile Health Check**:\n```dockerfile\nHEALTHCHECK --interval=30s --timeout=5s --start-period=10s --retries=3 \\\n  CMD node -e \"require('http').get('http://localhost:3000/health', (r) =\u003e process.exit(r.statusCode === 200 ? 0 : 1))\"\n```\n\n**Monitor Health via Dockerode**:\n```typescript\nconst container = docker.getContainer(containerId);\nconst info = await container.inspect();\n\nif (info.State.Health) {\n  console.log('Health status:', info.State.Health.Status);\n  console.log('Failed checks:', info.State.Health.FailingStreak);\n}\n```\n\n**Documentation**:\n- [Effective Docker Healthchecks for Node.js](https://patrickleet.medium.com/effective-docker-healthchecks-for-node-js-b11577c3e595)\n\n#### Agent Orchestration Patterns\n\n**Lifecycle Management**:\n1. Create workspace (temp directory)\n2. Clone repository into workspace\n3. Create Docker container with workspace mounted\n4. Start container\n5. Execute agent engine inside container (via Docker exec)\n6. Monitor health and collect results\n7. Stop and remove container\n8. Cleanup workspace\n\n**State Management**:\n```typescript\ninterface AgentState {\n  id: string;\n  status: 'idle' | 'running' | 'waiting' | 'error';\n  currentTask?: string;\n  memory: Record\u003cstring, any\u003e;\n  metadata: {\n    containerId: string;\n    startedAt: Date;\n    lastActive: Date;\n  };\n}\n```\n\n**Documentation**:\n- [Building Intelligent Multi-Agent System with Node.js](https://medium.com/@MNIVKA/building-an-intelligent-multi-agent-system-with-node-js-ai-orchestration-a1cc2835230a)\n\n### Recommended Architecture\n\n```\n┌─────────────────────────────────────────┐\n│         React Dashboard (Vite)          │\n│  - shadcn/ui components                 │\n│  - TanStack Query for API state         │\n│  - xterm.js for terminals               │\n│  - EventSource for log streaming        │\n└──────────────┬──────────────────────────┘\n               │ HTTP/WS/SSE\n┌──────────────▼──────────────────────────┐\n│      Fastify API Server (TypeScript)    │\n│  - Zod validation middleware            │\n│  - SSE endpoints for logs               │\n│  - WebSocket for terminals              │\n│  - REST API for CRUD operations         │\n└──────────────┬──────────────────────────┘\n               │ Dockerode\n┌──────────────▼──────────────────────────┐\n│       Docker Desktop (Mac ARM64)        │\n│  - Claude agent containers              │\n│  - Resource limits enforced             │\n│  - Health checks configured             │\n└─────────────────────────────────────────┘\n```\n\n---\n\n## 3. Codebase Analysis\n\n### Current Architecture\n\n**Agent Ops** is an autonomous work queue platform where AI agents execute work items from a Kanban board. The system is built with:\n\n**Tech Stack**:\n- Backend: Node.js 20+ with TypeScript, Fastify, SQLite (Drizzle ORM), WebSocket\n- Frontend: React 19.2 with TypeScript, Vite 7.2, Tailwind CSS 4.1, React Router 7.11, Zustand\n- Agent Runtime: Custom agent engine with LLM providers (Anthropic, OpenAI, Ollama, OpenRouter)\n- Package Manager: npm\n\n### Project Structure\n\n```\n/Users/probinson/Repos/on-par/saas/agent-ops/\n├── backend/\n│   ├── src/\n│   │   ├── index.ts                    # Server entry point\n│   │   ├── app.ts                      # Fastify app builder\n│   │   ├── cli.ts                      # CLI runner (agent-ops-4ka.13)\n│   │   ├── shared/\n│   │   │   ├── config.ts               # Environment configuration\n│   │   │   ├── db/\n│   │   │   │   ├── index.ts            # Database connection\n│   │   │   │   └── schema.ts           # Drizzle schema\n│   │   │   ├── git/\n│   │   │   │   └── git-operations.service.ts\n│   │   │   ├── websocket/\n│   │   │   │   └── websocket-hub.service.ts\n│   │   │   └── telemetry.ts\n│   │   └── features/\n│   │       ├── agent-runtime/\n│   │       │   ├── services/\n│   │       │   │   ├── agent-engine.service.ts    # Core agent execution\n│   │       │   │   ├── agent-tools.ts             # Tool definitions \u0026 executor\n│   │       │   │   ├── agent-executor.service.ts\n│   │       │   │   └── agent-lifecycle.service.ts\n│   │       │   ├── handler/\n│   │       │   │   └── agent-runtime.handler.ts   # REST API routes\n│   │       │   └── repositories/\n│   │       ├── llm-providers/\n│   │       │   ├── interfaces/\n│   │       │   │   └── llm-provider.interface.ts  # Provider abstraction\n│   │       │   ├── factory/\n│   │       │   │   └── provider.factory.ts        # Provider factory\n│   │       │   └── providers/\n│   │       ├── workers/\n│   │       │   ├── services/\n│   │       │   │   └── worker-pool.service.ts     # Worker lifecycle\n│   │       │   └── repositories/\n│   │       ├── workspaces/\n│   │       │   ├── services/\n│   │       │   │   └── workspace-manager.service.ts # Temp workspace creation\n│   │       │   └── repositories/\n│   │       └── [other features...]\n└── frontend/\n    ├── src/\n    │   ├── main.tsx\n    │   ├── App.tsx\n    │   ├── lib/\n    │   │   └── api.ts                  # API base URL config\n    │   ├── components/\n    │   │   └── Layout.tsx\n    │   └── pages/\n    │       ├── Dashboard.tsx            # Mission Control UI\n    │       ├── Kanban.tsx\n    │       ├── Agents.tsx\n    │       └── Settings.tsx\n```\n\n### Key Components\n\n#### 1. Agent Execution Engine\n**File**: `backend/src/features/agent-runtime/services/agent-engine.service.ts:1`\n\n**Purpose**: Core agent logic that runs tool-calling loops (Read → Think → Act → Observe)\n\n**Key Features**:\n- Loads tasks from bd (beads issue tracker)\n- Executes LLM with tool calls\n- Implements iteration limits\n- Tool executor for file operations, shell commands, glob search, grep\n- Supports commit on success\n\n**Interface**:\n```typescript\ninterface AgentEngineService {\n  execute(taskId: string, options: {\n    workspacePath: string;\n    maxIterations: number;\n    provider: LLMProvider;\n  }): Promise\u003cExecutionResult\u003e;\n}\n```\n\n#### 2. CLI Runner\n**File**: `backend/src/cli.ts:1`\n\n**Purpose**: Command-line interface for running agents without dashboard (completed issue agent-ops-4ka.13)\n\n**Key Features**:\n- Parses command-line arguments (provider, model, repo, workspace)\n- Sets up workspace (clone repo OR use existing directory)\n- Creates LLM provider instance\n- Instantiates AgentEngineService\n- Executes task and reports results\n\n**Usage**:\n```bash\nnpx agent-ops run \u003ctask-id\u003e --provider ollama --model qwen2.5-coder:7b\n```\n\n#### 3. LLM Provider Abstraction\n**File**: `backend/src/features/llm-providers/interfaces/llm-provider.interface.ts:1`\n\n**Interface**:\n```typescript\ninterface LLMProvider {\n  chat(messages: Message[], options?: ChatOptions): AsyncIterable\u003cChatChunk\u003e;\n  supportsToolCalling(): boolean;\n  callWithTools(messages: Message[], tools: Tool[]): Promise\u003cToolCallResult\u003e;\n}\n```\n\n**Supported Providers**:\n- Ollama (http://localhost:11434)\n- OpenAI (api.openai.com)\n- Anthropic (api.anthropic.com)\n- OpenRouter (openrouter.ai)\n\n#### 4. Git Operations Service\n**File**: `backend/src/shared/git/git-operations.service.ts:1`\n\n**Capabilities**:\n- Clone repository with authentication\n- Create and checkout branches\n- Stage changes, commit, push\n- Get diff and status\n- Create pull requests via GitHub API (Octokit)\n\n#### 5. Worker Pool Service\n**File**: `backend/src/features/workers/services/worker-pool.service.ts:1`\n\n**Purpose**: Manages agent worker lifecycle\n\n**Key Methods**:\n- `spawn(templateId, sessionId)`: Create worker\n- `terminate(workerId)`: Stop worker\n- `pause(workerId)`, `resume(workerId)`: Control execution\n- `assignWork(workerId, workItemId, role)`: Assign work\n- `updateMetrics(workerId, metrics)`: Track tokens, cost\n\n**Concurrency Control**: Configurable maxWorkers limit\n\n#### 6. Workspace Manager Service\n**File**: `backend/src/features/workspaces/services/workspace-manager.service.ts:1`\n\n**Purpose**: Manages temporary workspace directories for agent execution\n\n**Key Methods**:\n- `createWorkspace(workerId?, workItemId?, repositoryId?)`: Creates temp directory\n- `getWorkspacePath(id)`: Returns filesystem path\n- `cleanupWorkspace(id)`: Removes directory\n- `cleanupStaleWorkspaces(maxAgeMs)`: Cleanup old workspaces\n\n**Configuration**: Base directory (`/tmp/agent-workspaces`), cleanup delay (1 hour)\n\n#### 7. Configuration\n**File**: `backend/src/shared/config.ts:1`\n\n**Relevant Settings**:\n```typescript\ninterface Config {\n  port: number;                    // Default: 3001\n  host: string;                    // Default: 0.0.0.0\n  databaseUrl: string;             // Default: sqlite://./agent-ops.db\n  workspaceBaseDir: string;        // Default: /tmp/agent-workspaces\n  maxConcurrentAgents: number;     // Default: 5\n  agentTimeoutMs: number;          // Default: 600000 (10 min)\n  llmProvider: string;             // ollama, openai, anthropic, openrouter\n  llmModel: string;                // Default: qwen2.5-coder:7b\n}\n```\n\n#### 8. Database Schema\n**File**: `backend/src/shared/db/schema.ts:1`\n\n**Relevant Tables**:\n- `workspaces`: Tracks agent execution environments (path, status, branch, worker, work item)\n- `agentExecutions`: Execution records (status, duration, tokens, cost, output)\n- `workers`: Worker instances (template, status, current work, metrics)\n- `workItems`: Tasks on Kanban board\n\n**Status Enums**:\n- Workspace: `active | completed | error | cleaning`\n- Agent Execution: `pending | running | success | error | cancelled`\n- Worker: `idle | working | paused | error | terminated`\n\n#### 9. Fastify Application\n**File**: `backend/src/app.ts:1`\n\n**Current Setup**:\n- CORS enabled (dev: all origins, prod: restricted)\n- WebSocket support via @fastify/websocket\n- Pino logger (pino-pretty in dev)\n- Routes registered:\n  - `/api/work-items` - Work item management\n  - `/api/agent-runtime` - Agent execution APIs\n  - `/api/workers` - Worker management\n  - `/api/repositories`, `/api/pull-requests`\n\n### Existing Patterns to Follow\n\n#### Vertical Slice Architecture\nCode organized by feature, not layer:\n- `features/agent-runtime/` contains handlers, services, repositories, tests\n- `features/llm-providers/` contains provider interface, factory, implementations\n- Each feature is self-contained\n\n#### Service Layer Pattern\nServices contain business logic:\n```typescript\nexport class WorkerPoolService {\n  constructor(\n    private readonly workerRepository: WorkerRepository,\n    config?: WorkerPoolConfig\n  ) { ... }\n\n  async spawn(templateId: string, sessionId: string): Promise\u003cWorker\u003e { ... }\n}\n```\n\n#### Repository Pattern\nRepositories handle data access:\n- `WorkerRepository`, `WorkspaceRepository`, `AgentExecutionRepository`\n- Drizzle ORM for database operations\n- Separation of concerns: services call repositories\n\n#### Fastify Handler Plugin Pattern\n```typescript\nexport async function handlerName(\n  app: FastifyInstance,\n  options: HandlerOptions\n): Promise\u003cvoid\u003e {\n  const { db, config } = options;\n\n  app.post(\"/endpoint\", async (request, reply) =\u003e {\n    const data = schema.parse(request.body); // Zod validation\n    const result = await service.doSomething(data);\n    return result;\n  });\n}\n```\n\n#### Testing Patterns\n- Vitest for testing framework\n- AAA pattern (Arrange-Act-Assert)\n- Mock implementations for external dependencies\n- Test location: `features/*/tests/*.test.ts`\n\n---\n\n## 4. Proposed Solution Approach\n\n### High-Level Strategy\n\n**Hybrid Approach**: Add optional containerized execution while preserving existing in-process execution for development speed.\n\n**Key Design Decisions**:\n\n1. **Container Management**: Create new `ContainerManagerService` using Dockerode\n2. **Integration Point**: Extend `AgentExecutorService` to orchestrate container lifecycle\n3. **Database**: Add `containers` table to track container state\n4. **API**: Add `/api/containers` endpoints for lifecycle management\n5. **Logging**: Use SSE for real-time log streaming (better-sse)\n6. **Terminal**: Use WebSocket + xterm.js for interactive access\n7. **Frontend**: Extend existing Dashboard with container views (TanStack Query)\n\n### Container Lifecycle Flow\n\n```\n1. User triggers agent execution via API/CLI\n   ↓\n2. WorkspaceManagerService.createWorkspace()\n   → Creates temp directory: /tmp/agent-workspaces/{id}\n   ↓\n3. GitOperationsService.cloneRepository()\n   → Clones repo into workspace\n   ↓\n4. ContainerManagerService.createContainer()\n   → Creates Docker container with workspace mounted as volume\n   → Sets resource limits (CPU, memory)\n   → Configures environment variables (API keys, config)\n   ↓\n5. ContainerManagerService.startContainer()\n   → Starts container\n   → Begins health check monitoring\n   ↓\n6. AgentEngineService.execute() (inside container)\n   → Runs via Docker exec\n   → Streams output back to server\n   ↓\n7. ContainerManagerService.stopContainer()\n   → Gracefully stops container\n   ↓\n8. ContainerManagerService.removeContainer()\n   → Removes container and cleans up Docker resources\n   ↓\n9. WorkspaceManagerService.cleanupWorkspace()\n   → Removes temp directory\n```\n\n### Technology Choices with Justification\n\n| Component | Technology | Justification |\n|-----------|-----------|---------------|\n| Container Management | Dockerode | Most mature Docker SDK for Node.js, excellent stream handling, 12M+ weekly downloads |\n| Log Streaming | better-sse | Simpler than WebSocket for one-way streams, native browser support, TypeScript-first |\n| Terminal | WebSocket + xterm.js | Industry standard (Portainer, Selenoid), full terminal emulation |\n| API Validation | Zod | Type safety, runtime validation, already in codebase patterns |\n| State Management | TanStack Query | Best practice for server state in 2025, automatic cache invalidation |\n| UI Components | shadcn/ui | Modern, accessible, Tailwind integration (already in use) |\n| Logging | Pino | Already in use, 5-10x faster than Winston |\n| Framework | Fastify | Already in use, excellent TypeScript support, fast |\n\n### Key Implementation Steps\n\n#### Phase 1: Database \u0026 Core Services (P1)\n1. Add `containers` table to schema\n2. Create `ContainerRepository`\n3. Create `ContainerManagerService` with Dockerode\n4. Add unit tests for container lifecycle\n\n#### Phase 2: API Layer (P2)\n5. Create `ContainerHandler` with REST endpoints\n6. Extend `AgentExecutorService` to support containerized execution\n7. Add SSE endpoint for log streaming\n8. Add WebSocket endpoint for terminal access\n9. Add integration tests\n\n#### Phase 3: Frontend Integration (P3)\n10. Add TanStack Query hooks for container API\n11. Create `ContainerCard` component\n12. Create `ContainerLogs` component with SSE\n13. Create `ContainerTerminal` component with xterm.js\n14. Extend Dashboard to show containers\n15. Add E2E tests\n\n#### Phase 4: Docker \u0026 Deployment (P2)\n16. Create `Dockerfile.agent` for agent runtime\n17. Create `Dockerfile` for backend\n18. Create `Dockerfile` for frontend\n19. Create `docker-compose.yml` for orchestration\n20. Add documentation\n\n### Dependencies and Prerequisites\n\n**New Dependencies (Backend)**:\n```json\n{\n  \"dependencies\": {\n    \"dockerode\": \"^4.0.2\",\n    \"better-sse\": \"^0.13.0\",\n    \"ws\": \"^8.18.0\"\n  },\n  \"devDependencies\": {\n    \"@types/dockerode\": \"^3.3.31\",\n    \"@types/ws\": \"^8.5.13\"\n  }\n}\n```\n\n**New Dependencies (Frontend)**:\n```json\n{\n  \"dependencies\": {\n    \"@tanstack/react-query\": \"^5.62.21\",\n    \"@xterm/xterm\": \"^5.5.0\",\n    \"@xterm/addon-attach\": \"^0.11.0\",\n    \"@xterm/addon-fit\": \"^0.10.0\"\n  }\n}\n```\n\n**Prerequisites**:\n- Docker Desktop installed and running on Mac\n- `/var/run/docker.sock` accessible\n- Node.js 20+ with npm\n- Sufficient disk space for container images and workspaces\n\n---\n\n## 5. Next Steps\n\n### Recommended Implementation Order\n\n#### Step 1: Database Schema (Foundation)\n**File**: `backend/src/shared/db/schema.ts`\n\n**Action**: Add containers table\n```typescript\nexport const containers = sqliteTable(\"containers\", {\n  id: text(\"id\").primaryKey(),\n  containerId: text(\"container_id\").notNull().unique(),\n  workspaceId: text(\"workspace_id\").references(() =\u003e workspaces.id),\n  workerId: text(\"worker_id\").references(() =\u003e workers.id),\n  image: text(\"image\").notNull(),\n  status: text(\"status\").$type\u003cContainerStatus\u003e(),\n  createdAt: integer(\"created_at\", { mode: \"timestamp_ms\" }).notNull(),\n  stoppedAt: integer(\"stopped_at\", { mode: \"timestamp_ms\" }),\n});\n\nexport type ContainerStatus = 'creating' | 'running' | 'stopped' | 'error';\n```\n\n**Dependencies**: None (foundation for all other work)\n\n#### Step 2: Container Repository\n**File**: `backend/src/features/containers/repositories/container.repository.ts`\n\n**Action**: Create data access layer following existing repository patterns\n\n**Dependencies**: Schema changes must be complete\n\n#### Step 3: Container Manager Service (TDD)\n**Files**:\n- `backend/src/features/containers/services/container-manager.service.ts`\n- `backend/src/features/containers/tests/container-manager.service.test.ts`\n\n**Action**:\n1. Write tests first (TDD):\n   - Test container creation with workspace mount\n   - Test start/stop lifecycle\n   - Test exec in container\n   - Test log streaming\n   - Test error handling\n2. Implement service to pass tests\n\n**Dependencies**: Dockerode dependency added, repository created\n\n#### Step 4: Container Handler (API)\n**Files**:\n- `backend/src/features/containers/handler/container.handler.ts`\n- `backend/src/features/containers/tests/container.handler.test.ts`\n\n**Action**: Create REST API endpoints following Fastify handler pattern\n\n**Endpoints**:\n- `POST /api/containers` - Create container\n- `GET /api/containers` - List containers\n- `GET /api/containers/:id` - Get details\n- `POST /api/containers/:id/start` - Start\n- `POST /api/containers/:id/stop` - Stop\n- `DELETE /api/containers/:id` - Remove\n- `GET /api/containers/:id/logs` - Stream logs (SSE)\n\n**Dependencies**: Container manager service must exist\n\n#### Step 5: Agent Executor Integration\n**File**: `backend/src/features/agent-runtime/services/agent-executor.service.ts`\n\n**Action**: Extend to support containerized execution\n```typescript\nasync execute(taskId: string, options: {\n  containerized?: boolean; // NEW\n  // ... existing options\n}): Promise\u003cExecutionResult\u003e {\n  if (options.containerized) {\n    // Container-based execution flow\n  } else {\n    // Existing in-process execution\n  }\n}\n```\n\n**Dependencies**: Container manager service must be complete\n\n#### Step 6: Frontend Container Components\n**Files**:\n- `frontend/src/hooks/use-containers.ts` (TanStack Query)\n- `frontend/src/components/ContainerCard.tsx`\n- `frontend/src/components/ContainerLogs.tsx` (SSE)\n- `frontend/src/components/ContainerTerminal.tsx` (xterm.js)\n\n**Action**: Create React components for container visualization\n\n**Dependencies**: Backend API must be available\n\n#### Step 7: Docker Images\n**Files**:\n- `backend/Dockerfile.agent` (agent runtime image)\n- `backend/Dockerfile` (backend server image)\n- `frontend/Dockerfile` (frontend build + nginx)\n- `docker-compose.yml` (orchestration)\n\n**Action**: Create production-ready container images\n\n**Dependencies**: All services must be functional\n\n#### Step 8: E2E Testing\n**File**: Create E2E test for complete flow\n\n**Test Scenario**:\n1. Start agent via API\n2. Verify container created\n3. Stream logs via SSE\n4. Open terminal session\n5. Execute command in terminal\n6. Stop agent\n7. Verify cleanup\n\n**Dependencies**: All components must be integrated\n\n### Testing Considerations\n\n#### Unit Tests\n- **Container Manager Service**: Mock Dockerode, test lifecycle methods\n- **Container Repository**: Use in-memory SQLite, test CRUD operations\n- **Container Handler**: Use Fastify inject, test API endpoints\n\n#### Integration Tests\n- **Agent Executor + Containers**: Test full execution flow with real Docker\n- **SSE Log Streaming**: Test EventSource connection and data flow\n- **WebSocket Terminal**: Test terminal attach and command execution\n\n#### E2E Tests\n- **Complete User Flow**: Start agent → view logs → interact with terminal → stop agent\n- **Error Scenarios**: Container creation fails, agent crashes, network issues\n\n#### Test Coverage Goals\n- Unit tests: ≥80% coverage\n- Integration tests: All critical paths\n- E2E tests: Core user journeys\n\n### Configuration Management\n\n**Environment Variables** (`.env.example`):\n```bash\n# Server\nPORT=3001\nHOST=0.0.0.0\n\n# Database\nDATABASE_URL=sqlite://./agent-ops.db\n\n# LLM Provider\nLLM_PROVIDER=ollama\nLLM_MODEL=qwen2.5-coder:7b\nLLM_BASE_URL=http://host.docker.internal:11434\n\n# Docker\nDOCKER_AGENT_IMAGE=agent-ops/agent:latest\nDOCKER_SOCKET=/var/run/docker.sock\n\n# Agent Runtime\nWORKSPACE_BASE_DIR=/tmp/agent-workspaces\nMAX_CONCURRENT_AGENTS=5\nAGENT_TIMEOUT_MS=600000\n```\n\n### Security Considerations\n\n1. **Docker Socket Access**: Mounting `/var/run/docker.sock` gives full Docker access\n   - **Mitigation**: Run backend with minimal privileges, validate all container configs\n\n2. **Container Isolation**: Agents run user-provided code\n   - **Mitigation**: Resource limits, read-only root filesystem, non-root user\n\n3. **Secrets Management**: API keys passed to containers\n   - **Mitigation**: Use Docker secrets or file-based mounts, never log secrets\n\n4. **Network Security**: Containers should not access internal networks\n   - **Mitigation**: Use custom Docker network with limited access\n\n### Performance Optimization\n\n1. **Container Startup**: ~2-5 seconds overhead\n   - **Optimization**: Pre-build and cache agent image\n\n2. **Workspace Cleanup**: Disk space management\n   - **Optimization**: Background job to cleanup old workspaces\n\n3. **Log Storage**: Container logs can be large\n   - **Optimization**: Implement log rotation, max size limits\n\n4. **Resource Limits**: Prevent resource exhaustion\n   - **Optimization**: Enforce CPU/memory limits per container\n\n### Rollout Plan\n\n#### Development Phase\n1. Implement with in-process execution as fallback\n2. Make containerization opt-in via config flag\n3. Test thoroughly with local Ollama provider\n\n#### Testing Phase\n1. Deploy to staging environment\n2. Run E2E tests with real workloads\n3. Monitor resource usage and performance\n4. Gather feedback\n\n#### Production Phase\n1. Make containerization default for production\n2. Keep in-process execution for CLI/development\n3. Monitor metrics and logs\n4. Iterate based on usage patterns\n\n---\n\n## References\n\n### Web Research Sources\n\n**Docker Container Management**:\n- [Dockerode GitHub](https://github.com/apocas/dockerode)\n- [Dockerode npm](https://www.npmjs.com/package/dockerode)\n- [Dockerode: Streamlining Docker Management](https://abylin.medium.com/dockerode-streamlining-docker-management-using-node-js-9d2f72180fc0)\n\n**Real-time Log Streaming**:\n- [better-sse GitHub](https://github.com/MatthewWid/better-sse)\n- [SSE's Glorious Comeback (2025)](https://portalzine.de/sses-glorious-comeback-why-2025-is-the-year-of-server-sent-events/)\n- [Real-time Log Streaming with Node.js and React](https://dev.to/manojspace/real-time-log-streaming-with-nodejs-and-react-using-server-sent-events-sse-48pk)\n\n**Terminal Emulation**:\n- [xterm.js Official Site](https://xtermjs.org/)\n- [Building Browser Terminal with Docker and XtermJS](https://www.presidio.com/technical-blog/building-a-browser-based-terminal-using-docker-and-xtermjs/)\n\n**Dashboard Architecture**:\n- [shadcn-admin GitHub](https://github.com/rohitsoni007/shadcn-admin)\n- [TanStack Query Documentation](https://tanstack.com/query/latest)\n\n**TypeScript \u0026 Validation**:\n- [Building bulletproof ExpressJS APIs with Zod](https://blog.oscars.dev/posts/building-bulletproof-expressjs-apis-with-zod/)\n\n**Docker Security**:\n- [Docker Security 2025](https://www.onlinehashcrack.com/guides/best-practices/docker-security-2025-hardening-containers.php)\n- [Docker Secrets in Compose](https://docs.docker.com/compose/how-tos/use-secrets/)\n\n**Logging**:\n- [Pino Logger Complete Guide [2025]](https://signoz.io/guides/pino-logger/)\n- [Pino vs. Winston](https://dev.to/wallacefreitas/pino-vs-winston-choosing-the-right-logger-for-your-nodejs-application-369n)\n\n### Codebase Files Analyzed\n\n**Core Services**:\n- `backend/src/features/agent-runtime/services/agent-engine.service.ts:1`\n- `backend/src/features/agent-runtime/services/agent-executor.service.ts:1`\n- `backend/src/features/llm-providers/interfaces/llm-provider.interface.ts:1`\n- `backend/src/features/workers/services/worker-pool.service.ts:1`\n- `backend/src/features/workspaces/services/workspace-manager.service.ts:1`\n- `backend/src/shared/git/git-operations.service.ts:1`\n\n**Configuration \u0026 Infrastructure**:\n- `backend/src/shared/config.ts:1`\n- `backend/src/shared/db/schema.ts:1`\n- `backend/src/app.ts:1`\n- `backend/src/cli.ts:1`\n\n---\n\n## Conclusion\n\nThis research provides a comprehensive foundation for implementing the Local Agent Dashboard MVP with Docker container orchestration. The solution integrates modern best practices (SSE, xterm.js, TanStack Query, shadcn/ui) with the existing agent-ops codebase architecture, following established patterns while adding production-grade container isolation and monitoring capabilities.\n\n**Key Takeaways**:\n1. Use Dockerode for robust container management on Mac ARM64\n2. Implement SSE for efficient one-way log streaming\n3. Use WebSocket + xterm.js for interactive terminal access\n4. Follow existing vertical slice architecture and service patterns\n5. Add optional containerization without breaking existing workflows\n6. Prioritize security with resource limits and network isolation\n7. Use TDD throughout implementation\n\n**Next Action**: Review this research document, then proceed to planning phase to create detailed implementation tasks.\n","created_at":"2025-12-24T20:56:45Z"}]}
{"id":"agent-ops-4ka.1","title":"Agent Docker image (ARM64)","description":"Create Dockerfile for agent container:\n- Base: node:20-slim (ARM64 compatible)\n- Install: bd, git, aider (optional for Ollama mode)\n- NO Claude CLI required - uses provider abstraction\n- Entrypoint: node script that receives task config\n- Connects to host LLM via OLLAMA_HOST or LLM_BASE_URL\n- Volume mount for workspace\n\nEnvironment vars:\n- TASK_ID: bead issue to work on\n- LLM_PROVIDER: ollama|openai|anthropic|openrouter\n- LLM_MODEL: model name\n- LLM_BASE_URL: provider endpoint\n- LLM_API_KEY: for cloud providers","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-24T10:28:17.459493-06:00","updated_at":"2025-12-24T14:45:23.462169-06:00","dependencies":[{"issue_id":"agent-ops-4ka.1","depends_on_id":"agent-ops-4ka","type":"parent-child","created_at":"2025-12-24T10:28:17.470669-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4ka.10","title":"Agent execution engine","description":"Core agent logic that runs inside container:\n\n**Responsibilities:**\n- Load task from bd (bd show TASK_ID)\n- Plan approach using LLM\n- Execute steps: read files, edit, run commands\n- Tool calling loop (read → think → act → observe)\n- Commit changes on success\n- Report status back to orchestrator\n\n**Tool definitions (provider-agnostic):**\n- read_file(path) - Read file contents\n- write_file(path, content) - Write/create file\n- edit_file(path, old, new) - Search/replace edit\n- run_command(cmd) - Execute shell command\n- search_files(pattern) - Glob search\n- grep(pattern, path) - Content search\n\n**Uses LLM provider abstraction - works with any backend.**","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T10:43:29.955632-06:00","updated_at":"2025-12-24T12:22:53.942584-06:00","closed_at":"2025-12-24T12:22:53.942584-06:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-ops-4ka.10","depends_on_id":"agent-ops-4ka","type":"parent-child","created_at":"2025-12-24T10:43:29.965497-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4ka.11","title":"Dashboard: Provider settings","description":"UI to configure LLM provider:\n\n**Settings panel:**\n- Provider dropdown: Ollama, OpenAI, Anthropic, OpenRouter\n- Model selector (fetches available models from provider)\n- Base URL override (for self-hosted)\n- API key input (for cloud providers)\n- Test connection button\n\n**Persist to:**\n- Local storage (browser)\n- Or backend config endpoint\n\n**Show status:**\n- Provider connected/disconnected\n- Current model\n- Estimated cost per task (for paid providers)","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-24T10:43:40.094151-06:00","updated_at":"2025-12-24T11:02:05.349386-06:00","dependencies":[{"issue_id":"agent-ops-4ka.11","depends_on_id":"agent-ops-4ka","type":"parent-child","created_at":"2025-12-24T10:43:40.102087-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4ka.12","title":"Git operations service","description":"Git operations for agent workflow:\n\n**Operations:**\n- cloneRepo(url, workspace) - Clone to temp dir\n- createBranch(name) - Create and checkout branch\n- commitChanges(message) - Stage all and commit\n- pushBranch() - Push to origin\n- createPR(title, body) - Create PR via GitHub API\n\n**Uses existing GitHub service for API calls.**\n**Workspace cleanup on agent completion.**","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T11:02:14.784364-06:00","updated_at":"2025-12-24T12:30:37.026119-06:00","closed_at":"2025-12-24T12:30:37.026119-06:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-ops-4ka.12","depends_on_id":"agent-ops-4ka","type":"parent-child","created_at":"2025-12-24T11:02:14.791974-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4ka.13","title":"CLI runner for testing","description":"Simple CLI to run agent without dashboard:\n\n```bash\nnpx agent-ops run \u003ctask-id\u003e \\\n  --provider ollama \\\n  --model qwen2.5-coder:7b \\\n  --repo https://github.com/org/repo\n```\n\n**For fast iteration before dashboard is ready.**\n**Outputs agent actions to stdout.**","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T11:02:24.39814-06:00","updated_at":"2025-12-24T12:36:49.334677-06:00","closed_at":"2025-12-24T12:36:49.334677-06:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-ops-4ka.13","depends_on_id":"agent-ops-4ka","type":"parent-child","created_at":"2025-12-24T11:02:24.407511-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4ka.2","title":"Container lifecycle service","description":"Backend service to manage Docker containers:\n- Start container for a task (docker run)\n- Stop/kill container\n- List running containers\n- Capture container logs\n- Cleanup finished containers\n- Use dockerode npm package","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-24T10:28:19.744162-06:00","updated_at":"2025-12-24T14:45:24.800842-06:00","dependencies":[{"issue_id":"agent-ops-4ka.2","depends_on_id":"agent-ops-4ka","type":"parent-child","created_at":"2025-12-24T10:28:19.750405-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4ka.3","title":"SSE log streaming endpoint","description":"Add SSE endpoint to stream container logs:\n- GET /api/agents/:containerId/logs (SSE)\n- Stream docker logs in real-time\n- Handle container exit gracefully\n- Include timestamps and log levels","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-24T10:28:21.395737-06:00","updated_at":"2025-12-24T11:02:04.372275-06:00","dependencies":[{"issue_id":"agent-ops-4ka.3","depends_on_id":"agent-ops-4ka","type":"parent-child","created_at":"2025-12-24T10:28:21.403487-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4ka.4","title":"Agent REST API","description":"REST endpoints for agent management:\n- POST /api/agents/start { taskId, pattern? }\n- DELETE /api/agents/:id (stop)\n- GET /api/agents (list running)\n- GET /api/agents/:id (status + details)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-24T10:28:23.052508-06:00","updated_at":"2025-12-24T11:02:04.560956-06:00","dependencies":[{"issue_id":"agent-ops-4ka.4","depends_on_id":"agent-ops-4ka","type":"parent-child","created_at":"2025-12-24T10:28:23.061014-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4ka.5","title":"Dashboard: Agent list component","description":"React component showing running agents:\n- Card per agent: task ID, status, duration\n- Start/stop buttons\n- Click to view logs\n- Auto-refresh via WebSocket or polling\n- Empty state: 'No agents running'","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-24T10:28:24.947885-06:00","updated_at":"2025-12-24T11:02:04.757919-06:00","dependencies":[{"issue_id":"agent-ops-4ka.5","depends_on_id":"agent-ops-4ka","type":"parent-child","created_at":"2025-12-24T10:28:24.959922-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4ka.6","title":"Dashboard: Terminal component","description":"Terminal viewer using xterm.js:\n- npm install xterm xterm-addon-fit\n- Connect to SSE log stream\n- ANSI color support\n- Auto-scroll with pause option\n- Resize handling","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-24T10:28:26.473326-06:00","updated_at":"2025-12-24T11:02:04.946513-06:00","dependencies":[{"issue_id":"agent-ops-4ka.6","depends_on_id":"agent-ops-4ka","type":"parent-child","created_at":"2025-12-24T10:28:26.479161-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4ka.7","title":"Dashboard: Start agent flow","description":"UI to start new agents:\n- Button to open start dialog\n- Select from ready tasks (bd ready)\n- Or enter pattern filter\n- Set max concurrent limit\n- Show confirmation before starting","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-24T10:28:38.114341-06:00","updated_at":"2025-12-24T11:02:05.14773-06:00","dependencies":[{"issue_id":"agent-ops-4ka.7","depends_on_id":"agent-ops-4ka","type":"parent-child","created_at":"2025-12-24T10:28:38.122071-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4ka.8","title":"E2E: Start agent, view logs, stop","description":"Integration test for full flow:\n- Start agent from dashboard\n- See it appear in agent list\n- View live logs in terminal\n- Stop agent\n- Verify container cleaned up","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-24T10:28:39.979068-06:00","updated_at":"2025-12-24T11:02:05.557601-06:00","dependencies":[{"issue_id":"agent-ops-4ka.8","depends_on_id":"agent-ops-4ka","type":"parent-child","created_at":"2025-12-24T10:28:39.99027-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4ka.9","title":"LLM Provider abstraction layer","description":"Create provider-agnostic LLM interface:\n\n**Interface:**\n```typescript\ninterface LLMProvider {\n  chat(messages: Message[], options?: ChatOptions): AsyncIterable\u003cChatChunk\u003e;\n  supportsToolCalling(): boolean;\n  callWithTools(messages: Message[], tools: Tool[]): Promise\u003cToolCallResult\u003e;\n}\n```\n\n**Providers to implement:**\n- OllamaProvider (http://localhost:11434/v1)\n- OpenAIProvider (api.openai.com)\n- AnthropicProvider (api.anthropic.com)\n- OpenRouterProvider (openrouter.ai/api)\n\n**Config:**\n```yaml\nllm:\n  provider: ollama  # or openai, anthropic, openrouter\n  model: qwen2.5-coder:7b\n  baseUrl: http://localhost:11434  # optional override\n  apiKey: ${LLM_API_KEY}  # for cloud providers\n```\n\nAll providers use OpenAI-compatible API where possible.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T10:43:04.350298-06:00","updated_at":"2025-12-24T12:20:11.258106-06:00","closed_at":"2025-12-24T12:20:11.258106-06:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-ops-4ka.9","depends_on_id":"agent-ops-4ka","type":"parent-child","created_at":"2025-12-24T10:43:04.351463-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4rv","title":"Create E2E test script with Playwright for Aspire integration","description":"Create an automated E2E test script that:\n1. Starts Aspire (dotnet run --project AppHost)\n2. Waits for services to be ready\n3. Uses Playwright (headless) to verify:\n   - Backend API responds\n   - Frontend loads\n   - Aspire Dashboard shows services\n   - Telemetry traces appear\n4. Cleans up processes on exit\n\nScript: e2e-test.sh or similar","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-23T14:20:00.732633-06:00","updated_at":"2025-12-23T14:38:11.214158-06:00","closed_at":"2025-12-23T14:38:11.214158-06:00","close_reason":"Closed","labels":["testing aspire"]}
{"id":"agent-ops-4yu","title":"Phase 5: Frontend Integration","description":"Connect frontend to backend with Zustand stores, API client, React Query, WebSocket real-time updates, and drag-and-drop functionality.","status":"open","priority":3,"issue_type":"epic","created_at":"2025-12-20T22:44:01.369637-06:00","updated_at":"2025-12-23T20:18:45.852494-06:00","labels":["frontend","integration"],"dependencies":[{"issue_id":"agent-ops-4yu","depends_on_id":"agent-ops-ll0","type":"blocks","created_at":"2025-12-20T22:47:28.781511-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4yu.1","title":"Implement API client","description":"Create src/api/client.ts with fetch wrapper and typed methods for all backend endpoints (work-items, templates, workers, metrics, config).","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:46:40.67856-06:00","updated_at":"2025-12-23T20:18:46.099883-06:00","labels":["api","frontend"],"dependencies":[{"issue_id":"agent-ops-4yu.1","depends_on_id":"agent-ops-4yu","type":"parent-child","created_at":"2025-12-20T22:46:40.68128-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4yu.10","title":"Connect Agents page to real data","description":"Replace hardcoded mock data in Agents.tsx with React Query hooks and implement worker control actions.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:46:52.331297-06:00","updated_at":"2025-12-23T20:18:48.494035-06:00","labels":["frontend","integration"],"dependencies":[{"issue_id":"agent-ops-4yu.10","depends_on_id":"agent-ops-4yu","type":"parent-child","created_at":"2025-12-20T22:46:52.334053-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4yu.2","title":"Implement WorkItems Zustand store","description":"Create src/stores/work-items.store.ts with state and actions for work item CRUD, status transitions, and optimistic updates.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:46:41.679572-06:00","updated_at":"2025-12-23T20:18:46.344213-06:00","labels":["frontend","state"],"dependencies":[{"issue_id":"agent-ops-4yu.2","depends_on_id":"agent-ops-4yu","type":"parent-child","created_at":"2025-12-20T22:46:41.683109-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4yu.3","title":"Implement Workers Zustand store","description":"Create src/stores/workers.store.ts with state and actions for agent workers, status updates, and metrics.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:46:43.103687-06:00","updated_at":"2025-12-23T20:18:46.582186-06:00","labels":["frontend","state"],"dependencies":[{"issue_id":"agent-ops-4yu.3","depends_on_id":"agent-ops-4yu","type":"parent-child","created_at":"2025-12-20T22:46:43.106622-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4yu.4","title":"Implement Templates Zustand store","description":"Create src/stores/templates.store.ts with state and actions for agent template management.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:46:44.139927-06:00","updated_at":"2025-12-23T20:18:46.82238-06:00","labels":["frontend","state"],"dependencies":[{"issue_id":"agent-ops-4yu.4","depends_on_id":"agent-ops-4yu","type":"parent-child","created_at":"2025-12-20T22:46:44.142658-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4yu.5","title":"Setup React Query integration","description":"Configure React Query provider, create query hooks for data fetching with caching, and integrate with Zustand stores.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:46:46.344097-06:00","updated_at":"2025-12-23T20:18:47.059184-06:00","labels":["data","frontend"],"dependencies":[{"issue_id":"agent-ops-4yu.5","depends_on_id":"agent-ops-4yu","type":"parent-child","created_at":"2025-12-20T22:46:46.346757-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4yu.6","title":"Implement WebSocket client","description":"Create src/hooks/useWebSocket.ts using react-use-websocket for real-time updates, reconnection handling, and event dispatching to stores.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:46:47.467021-06:00","updated_at":"2025-12-23T20:18:47.295653-06:00","labels":["frontend","websocket"],"dependencies":[{"issue_id":"agent-ops-4yu.6","depends_on_id":"agent-ops-4yu","type":"parent-child","created_at":"2025-12-20T22:46:47.469636-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4yu.7","title":"Implement Kanban drag-and-drop","description":"Integrate @dnd-kit for Kanban board task reordering and column transitions with backend sync.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:46:48.468861-06:00","updated_at":"2025-12-23T20:18:47.538235-06:00","labels":["frontend","ui"],"dependencies":[{"issue_id":"agent-ops-4yu.7","depends_on_id":"agent-ops-4yu","type":"parent-child","created_at":"2025-12-20T22:46:48.471813-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4yu.8","title":"Connect Dashboard to real data","description":"Replace hardcoded mock data in Dashboard.tsx with React Query hooks fetching from backend APIs.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:46:49.758444-06:00","updated_at":"2025-12-23T20:18:47.878167-06:00","labels":["frontend","integration"],"dependencies":[{"issue_id":"agent-ops-4yu.8","depends_on_id":"agent-ops-4yu","type":"parent-child","created_at":"2025-12-20T22:46:49.761044-06:00","created_by":"daemon"}]}
{"id":"agent-ops-4yu.9","title":"Connect Kanban to real data","description":"Replace hardcoded mock data in Kanban.tsx with React Query hooks and implement status transition calls.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:46:51.051945-06:00","updated_at":"2025-12-23T20:18:48.196416-06:00","labels":["frontend","integration"],"dependencies":[{"issue_id":"agent-ops-4yu.9","depends_on_id":"agent-ops-4yu","type":"parent-child","created_at":"2025-12-20T22:46:51.054475-06:00","created_by":"daemon"}]}
{"id":"agent-ops-7vk","title":"Phase 2: Business Logic","description":"Implement core services layer including work item management, template registry, worker pool, and workflow engine with state machine transitions and approval gates.","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-20T22:43:57.535971-06:00","updated_at":"2025-12-22T08:44:08.195136-06:00","closed_at":"2025-12-22T08:44:08.195136-06:00","close_reason":"Closed","labels":["backend","services"],"dependencies":[{"issue_id":"agent-ops-7vk","depends_on_id":"agent-ops-0fl","type":"blocks","created_at":"2025-12-20T22:47:28.120681-06:00","created_by":"daemon"}]}
{"id":"agent-ops-7vk.1","title":"Implement WorkItem service","description":"Create src/services/work-item.service.ts with business logic for work item lifecycle, status transitions, and success criteria management.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-20T22:45:03.757551-06:00","updated_at":"2025-12-21T13:22:04.890858-06:00","closed_at":"2025-12-21T13:22:04.890858-06:00","close_reason":"Closed","labels":["backend","services"],"dependencies":[{"issue_id":"agent-ops-7vk.1","depends_on_id":"agent-ops-7vk","type":"parent-child","created_at":"2025-12-20T22:45:03.760792-06:00","created_by":"daemon"}]}
{"id":"agent-ops-7vk.2","title":"Implement Template registry service","description":"Create src/services/template-registry.service.ts for managing agent templates including built-in templates and user-defined templates.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:45:04.712367-06:00","updated_at":"2025-12-22T08:43:52.017783-06:00","closed_at":"2025-12-22T08:43:52.017783-06:00","close_reason":"Closed","labels":["backend","services"],"dependencies":[{"issue_id":"agent-ops-7vk.2","depends_on_id":"agent-ops-7vk","type":"parent-child","created_at":"2025-12-20T22:45:04.71523-06:00","created_by":"daemon"}]}
{"id":"agent-ops-7vk.3","title":"Implement Worker pool service","description":"Create src/services/worker-pool.service.ts for managing agent worker lifecycle, concurrency limits (max_workers), and work queue.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-20T22:45:05.940132-06:00","updated_at":"2025-12-21T13:22:05.098858-06:00","closed_at":"2025-12-21T13:22:05.098858-06:00","close_reason":"Closed","labels":["backend","services"],"dependencies":[{"issue_id":"agent-ops-7vk.3","depends_on_id":"agent-ops-7vk","type":"parent-child","created_at":"2025-12-20T22:45:05.943504-06:00","created_by":"daemon"}]}
{"id":"agent-ops-7vk.4","title":"Implement Workflow engine service","description":"Create src/services/workflow-engine.service.ts with state machine for Kanban transitions, configurable approval gates, and work assignment logic.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-20T22:45:07.018829-06:00","updated_at":"2025-12-21T13:22:05.309043-06:00","closed_at":"2025-12-21T13:22:05.309043-06:00","close_reason":"Closed","labels":["backend","services"],"dependencies":[{"issue_id":"agent-ops-7vk.4","depends_on_id":"agent-ops-7vk","type":"parent-child","created_at":"2025-12-20T22:45:07.02171-06:00","created_by":"daemon"}]}
{"id":"agent-ops-7vk.5","title":"Implement Observability service","description":"Create src/services/observability.service.ts for collecting agent metrics, token usage, cost tracking, and trace events.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T22:45:08.33106-06:00","updated_at":"2025-12-22T08:43:52.267105-06:00","closed_at":"2025-12-22T08:43:52.267105-06:00","close_reason":"Closed","labels":["backend","services"],"dependencies":[{"issue_id":"agent-ops-7vk.5","depends_on_id":"agent-ops-7vk","type":"parent-child","created_at":"2025-12-20T22:45:08.333737-06:00","created_by":"daemon"}]}
{"id":"agent-ops-7vk.6","title":"Implement WebSocket hub service","description":"Create src/services/websocket-hub.service.ts for real-time event broadcasting to connected clients including agent state, work item updates, and metrics.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T22:45:09.695881-06:00","updated_at":"2025-12-22T08:43:52.521286-06:00","closed_at":"2025-12-22T08:43:52.521286-06:00","close_reason":"Closed","labels":["backend","services"],"dependencies":[{"issue_id":"agent-ops-7vk.6","depends_on_id":"agent-ops-7vk","type":"parent-child","created_at":"2025-12-20T22:45:09.703399-06:00","created_by":"daemon"}]}
{"id":"agent-ops-93m","title":"Phase 0: Aspire Infrastructure Migration","description":"Convert the existing codebase to use .NET Aspire for service orchestration, telemetry, and local development experience. This enables polyglot service management, OpenTelemetry-based observability, and the Aspire Dashboard for debugging agent behavior.\n\n## Why Aspire?\n- Multi-agent orchestration with service discovery\n- OpenTelemetry integration (industry standard, portable to production APM)\n- Aspire Dashboard for real-time traces, logs, metrics visualization\n- Future-proof for adding Redis, Postgres, message queues\n- Better developer experience than Makefile-based orchestration\n\n## Scope\n- Add C# AppHost project (~30 lines) for orchestration\n- Add OpenTelemetry SDK to Node.js backend\n- Refactor ObservabilityService to emit OTEL spans\n- Remove Makefile orchestration (replaced by Aspire)\n- Requires .NET 10 SDK for Aspire 13 polyglot features\n\n## What's Preserved\n- All Drizzle schema and migrations\n- All Zod models\n- All repositories\n- All business logic services\n- Frontend components unchanged","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-22T14:09:46.480209-06:00","updated_at":"2025-12-23T14:38:27.834905-06:00","closed_at":"2025-12-23T14:38:27.834905-06:00","close_reason":"Closed","labels":["aspire","infrastructure"]}
{"id":"agent-ops-93m.1","title":"Add AppHost C# project for Aspire orchestration","description":"Create the C# AppHost project that orchestrates the Node.js backend and React frontend using Aspire 13.\n\n## Files to Create\n```\nAppHost/\n├── AppHost.csproj\n└── Program.cs\n```\n\n## AppHost.csproj\n```xml\n\u003cProject Sdk=\"Microsoft.NET.Sdk\"\u003e\n  \u003cPropertyGroup\u003e\n    \u003cOutputType\u003eExe\u003c/OutputType\u003e\n    \u003cTargetFramework\u003enet10.0\u003c/TargetFramework\u003e\n    \u003cIsAspireHost\u003etrue\u003c/IsAspireHost\u003e\n  \u003c/PropertyGroup\u003e\n  \u003cItemGroup\u003e\n    \u003cPackageReference Include=\"Aspire.Hosting\" Version=\"13.*\" /\u003e\n    \u003cPackageReference Include=\"Aspire.Hosting.NodeJs\" Version=\"13.*\" /\u003e\n  \u003c/ItemGroup\u003e\n\u003c/Project\u003e\n```\n\n## Program.cs\n```csharp\nvar builder = DistributedApplication.CreateBuilder(args);\n\nvar backend = builder.AddNodeApp(\"backend\", \"../backend\", \"dist/index.js\")\n    .WithHttpEndpoint(port: 3001, name: \"api\");\n\nvar frontend = builder.AddViteApp(\"frontend\", \"../frontend\")\n    .WithReference(backend);\n\nbuilder.Build().Run();\n```\n\n## Prerequisites\n- Install .NET 10 SDK\n- Run `dotnet workload install aspire`\n\n## Acceptance Criteria\n- [ ] AppHost project builds successfully\n- [ ] `dotnet run --project AppHost` starts both backend and frontend\n- [ ] Aspire Dashboard accessible at http://localhost:15888","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T14:10:01.53767-06:00","updated_at":"2025-12-23T12:45:38.746975-06:00","closed_at":"2025-12-23T12:45:38.746975-06:00","close_reason":"Closed","labels":["aspire","dotnet","infrastructure"],"dependencies":[{"issue_id":"agent-ops-93m.1","depends_on_id":"agent-ops-93m","type":"parent-child","created_at":"2025-12-22T14:10:01.540984-06:00","created_by":"daemon"}]}
{"id":"agent-ops-93m.2","title":"Add OpenTelemetry SDK packages to backend","description":"Install the OpenTelemetry Node.js SDK packages required for emitting traces, metrics, and logs to the Aspire Dashboard.\n\n## Packages to Install\n```bash\nnpm install @opentelemetry/sdk-node \\\n  @opentelemetry/api \\\n  @opentelemetry/auto-instrumentations-node \\\n  @opentelemetry/exporter-trace-otlp-grpc \\\n  @opentelemetry/exporter-metrics-otlp-grpc \\\n  @opentelemetry/resources \\\n  @opentelemetry/semantic-conventions\n```\n\n## Why These Packages\n- `@opentelemetry/sdk-node`: Core SDK for Node.js\n- `@opentelemetry/api`: API for creating custom spans\n- `@opentelemetry/auto-instrumentations-node`: Auto-instrument HTTP, Fastify, etc.\n- `@opentelemetry/exporter-*-otlp-grpc`: Export to Aspire Dashboard via OTLP/gRPC\n\n## Acceptance Criteria\n- [ ] All packages installed without conflicts\n- [ ] TypeScript types available for all packages\n- [ ] No breaking changes to existing dependencies","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T14:10:15.596645-06:00","updated_at":"2025-12-23T12:45:38.980894-06:00","closed_at":"2025-12-23T12:45:38.980894-06:00","close_reason":"Closed","labels":["aspire","backend","opentelemetry"],"dependencies":[{"issue_id":"agent-ops-93m.2","depends_on_id":"agent-ops-93m","type":"parent-child","created_at":"2025-12-22T14:10:15.5999-06:00","created_by":"daemon"}]}
{"id":"agent-ops-93m.3","title":"Initialize OpenTelemetry in backend startup","description":"Configure and initialize OpenTelemetry SDK at backend startup, before Fastify server starts.\n\n## Create src/telemetry.ts\n```typescript\nimport { NodeSDK } from '@opentelemetry/sdk-node';\nimport { getNodeAutoInstrumentations } from '@opentelemetry/auto-instrumentations-node';\nimport { OTLPTraceExporter } from '@opentelemetry/exporter-trace-otlp-grpc';\nimport { OTLPMetricExporter } from '@opentelemetry/exporter-metrics-otlp-grpc';\nimport { Resource } from '@opentelemetry/resources';\nimport { ATTR_SERVICE_NAME } from '@opentelemetry/semantic-conventions';\n\nconst sdk = new NodeSDK({\n  resource: new Resource({\n    [ATTR_SERVICE_NAME]: process.env.OTEL_SERVICE_NAME || 'agent-ops-backend',\n  }),\n  traceExporter: new OTLPTraceExporter({\n    url: process.env.OTEL_EXPORTER_OTLP_ENDPOINT || 'http://localhost:4317',\n  }),\n  metricReader: new OTLPMetricExporter({\n    url: process.env.OTEL_EXPORTER_OTLP_ENDPOINT || 'http://localhost:4317',\n  }),\n  instrumentations: [getNodeAutoInstrumentations()],\n});\n\nexport function initTelemetry() {\n  sdk.start();\n  process.on('SIGTERM', () =\u003e sdk.shutdown());\n}\n```\n\n## Update src/index.ts\nImport and call `initTelemetry()` BEFORE creating Fastify instance.\n\n## Environment Variables (auto-injected by Aspire)\n- OTEL_SERVICE_NAME\n- OTEL_EXPORTER_OTLP_ENDPOINT\n\n## Acceptance Criteria\n- [ ] Telemetry initializes without errors\n- [ ] HTTP requests appear as traces in Aspire Dashboard\n- [ ] Graceful shutdown on SIGTERM","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T14:10:30.057378-06:00","updated_at":"2025-12-23T12:45:39.193703-06:00","closed_at":"2025-12-23T12:45:39.193703-06:00","close_reason":"Closed","labels":["aspire","backend","opentelemetry"],"dependencies":[{"issue_id":"agent-ops-93m.3","depends_on_id":"agent-ops-93m","type":"parent-child","created_at":"2025-12-22T14:10:30.060164-06:00","created_by":"daemon"},{"issue_id":"agent-ops-93m.3","depends_on_id":"agent-ops-93m.2","type":"blocks","created_at":"2025-12-22T14:10:30.061485-06:00","created_by":"daemon"}]}
{"id":"agent-ops-93m.4","title":"Refactor ObservabilityService for OpenTelemetry spans","description":"Refactor ObservabilityService to emit OpenTelemetry spans in addition to SQLite traces. Keep SQLite for domain-specific aggregation queries.\n\n## Approach: Dual Output\n1. **OpenTelemetry spans** → Aspire Dashboard visualization\n2. **SQLite traces** → Domain queries (cost summaries, tool stats)\n\n## Changes to ObservabilityService\n\n### Add tracer instance\n```typescript\nimport { trace, SpanKind, SpanStatusCode } from '@opentelemetry/api';\n\nconst tracer = trace.getTracer('agent-ops');\n```\n\n### Modify recordTrace() to emit OTEL span\n```typescript\nasync recordTrace(trace: Omit\u003cNewTrace, 'id' | 'timestamp'\u003e): Promise\u003cTrace\u003e {\n  // Emit OTEL span\n  const span = tracer.startSpan(trace.eventType, {\n    kind: SpanKind.INTERNAL,\n    attributes: {\n      'agent.worker_id': trace.workerId ?? undefined,\n      'agent.work_item_id': trace.workItemId ?? undefined,\n      ...flattenData(trace.data),\n    },\n  });\n  span.end();\n\n  // Also write to SQLite for queries\n  // ... existing SQLite insert logic ...\n}\n```\n\n### Add helper for custom spans\n```typescript\nstartAgentSpan(name: string, workerId: string): Span {\n  return tracer.startSpan(name, {\n    attributes: { 'agent.worker_id': workerId },\n  });\n}\n```\n\n## What to Keep in SQLite\n- getCostSummary() - domain-specific aggregation\n- getToolCallStats() - per-tool breakdown\n- getSystemMetrics() - worker aggregations\n- getTraceStatsByEventType() - event distribution\n\n## Acceptance Criteria\n- [ ] All trace events appear in Aspire Dashboard\n- [ ] SQLite queries still work for aggregations\n- [ ] Tool calls show as child spans of agent operations\n- [ ] Errors have proper OTEL status codes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T14:10:48.758777-06:00","updated_at":"2025-12-23T12:55:49.210671-06:00","closed_at":"2025-12-23T12:55:49.210671-06:00","close_reason":"Refactored ObservabilityService to emit OpenTelemetry spans. Added tracer instance, modified recordTrace() to emit OTEL spans in addition to SQLite, added flattenData() helper, and added startAgentSpan() method. All SQLite query methods remain unchanged. All 53 tests passing, build successful.","labels":["aspire","backend","opentelemetry","refactor"],"dependencies":[{"issue_id":"agent-ops-93m.4","depends_on_id":"agent-ops-93m","type":"parent-child","created_at":"2025-12-22T14:10:48.761593-06:00","created_by":"daemon"},{"issue_id":"agent-ops-93m.4","depends_on_id":"agent-ops-93m.3","type":"blocks","created_at":"2025-12-22T14:10:48.762972-06:00","created_by":"daemon"}]}
{"id":"agent-ops-93m.5","title":"Update environment configuration for Aspire","description":"Update environment configuration to use Aspire-injected values instead of hardcoded defaults.\n\n## Aspire Auto-Injected Variables\nAspire automatically injects these environment variables:\n- `OTEL_SERVICE_NAME` - Service name for telemetry\n- `OTEL_EXPORTER_OTLP_ENDPOINT` - OTLP collector endpoint\n- `services__backend__api__0` - Backend URL for frontend\n\n## Backend Changes (src/config.ts or equivalent)\n```typescript\nexport const config = {\n  port: parseInt(process.env.PORT || '3001'),\n  host: process.env.HOST || '0.0.0.0',\n  // Remove hardcoded OTEL config - use Aspire-injected values\n  // OTEL SDK reads from env automatically\n};\n```\n\n## Frontend Changes\nUpdate API client to use injected backend URL:\n```typescript\nconst API_BASE = import.meta.env.VITE_API_URL \n  || process.env.services__backend__api__0 \n  || 'http://localhost:3001';\n```\n\n## Update AppHost to pass frontend env\n```csharp\nvar frontend = builder.AddViteApp(\"frontend\", \"../frontend\")\n    .WithReference(backend)\n    .WithEnvironment(\"VITE_API_URL\", backend.GetEndpoint(\"api\"));\n```\n\n## Acceptance Criteria\n- [ ] Backend reads OTEL config from environment\n- [ ] Frontend connects to backend via Aspire service discovery\n- [ ] No hardcoded localhost URLs remain\n- [ ] Works in both Aspire-managed and standalone modes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T14:11:03.511642-06:00","updated_at":"2025-12-23T12:53:16.487997-06:00","closed_at":"2025-12-23T12:53:16.487997-06:00","close_reason":"Closed","labels":["aspire","backend","config","frontend"],"dependencies":[{"issue_id":"agent-ops-93m.5","depends_on_id":"agent-ops-93m","type":"parent-child","created_at":"2025-12-22T14:11:03.51486-06:00","created_by":"daemon"},{"issue_id":"agent-ops-93m.5","depends_on_id":"agent-ops-93m.1","type":"blocks","created_at":"2025-12-22T14:11:03.516283-06:00","created_by":"daemon"}]}
{"id":"agent-ops-93m.6","title":"Remove Makefile orchestration","description":"Remove the Makefile-based orchestration now that Aspire handles service startup.\n\n## Files to Remove/Modify\n\n### Delete\n- `Makefile` (orchestration replaced by Aspire)\n\n### Keep useful npm scripts in package.json\nBackend package.json:\n```json\n{\n  \"scripts\": {\n    \"dev\": \"tsx watch src/index.ts\",\n    \"build\": \"tsc\",\n    \"start\": \"node dist/index.js\",\n    \"test\": \"vitest\",\n    \"db:push\": \"drizzle-kit push\",\n    \"db:studio\": \"drizzle-kit studio\"\n  }\n}\n```\n\nFrontend package.json:\n```json\n{\n  \"scripts\": {\n    \"dev\": \"vite\",\n    \"build\": \"vite build\",\n    \"preview\": \"vite preview\"\n  }\n}\n```\n\n## New Workflow\n```bash\n# Start everything with Aspire\ndotnet run --project AppHost\n\n# Individual service dev (if needed)\ncd backend \u0026\u0026 npm run dev\ncd frontend \u0026\u0026 npm run dev\n\n# Database operations\ncd backend \u0026\u0026 npm run db:push\n```\n\n## Acceptance Criteria\n- [ ] Makefile deleted\n- [ ] npm scripts work independently\n- [ ] README updated with new workflow\n- [ ] No orphaned PID files in /tmp","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T14:11:17.235982-06:00","updated_at":"2025-12-23T12:57:31.848159-06:00","closed_at":"2025-12-23T12:57:31.848159-06:00","close_reason":"Closed","labels":["cleanup","infrastructure"],"dependencies":[{"issue_id":"agent-ops-93m.6","depends_on_id":"agent-ops-93m","type":"parent-child","created_at":"2025-12-22T14:11:17.239551-06:00","created_by":"daemon"},{"issue_id":"agent-ops-93m.6","depends_on_id":"agent-ops-93m.1","type":"blocks","created_at":"2025-12-22T14:11:17.240836-06:00","created_by":"daemon"},{"issue_id":"agent-ops-93m.6","depends_on_id":"agent-ops-93m.5","type":"blocks","created_at":"2025-12-22T14:11:17.241388-06:00","created_by":"daemon"}]}
{"id":"agent-ops-93m.7","title":"Test Aspire integration end-to-end","description":"Verify the complete Aspire integration works end-to-end.\n\n## Test Scenarios\n\n### 1. Service Startup\n```bash\ndotnet run --project AppHost\n```\n- [ ] Backend starts on port 3001\n- [ ] Frontend starts on Vite dev server\n- [ ] Aspire Dashboard accessible at http://localhost:15888\n\n### 2. Aspire Dashboard Verification\n- [ ] Both services appear in Resources view\n- [ ] Service endpoints listed correctly\n- [ ] Environment variables visible\n\n### 3. Telemetry Flow\n- [ ] Make HTTP request to backend\n- [ ] Verify trace appears in Dashboard Traces view\n- [ ] Check span attributes include service name\n\n### 4. Custom Spans (Agent Operations)\n- [ ] Trigger agent state change\n- [ ] Verify custom span in Dashboard\n- [ ] Check worker_id attribute present\n\n### 5. Error Handling\n- [ ] Trigger an error condition\n- [ ] Verify error span has ERROR status\n- [ ] Check error details in span attributes\n\n### 6. Metrics\n- [ ] Verify runtime metrics in Dashboard\n- [ ] Check HTTP request metrics\n\n### 7. Graceful Shutdown\n- [ ] Stop Aspire (Ctrl+C)\n- [ ] Verify clean shutdown (no orphan processes)\n- [ ] Check final telemetry flushed\n\n## Acceptance Criteria\n- [ ] All test scenarios pass\n- [ ] No console errors during operation\n- [ ] Telemetry latency acceptable (\u003c100ms)\n- [ ] Memory usage stable over time","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T14:11:32.24349-06:00","updated_at":"2025-12-23T14:38:12.680203-06:00","closed_at":"2025-12-23T14:38:12.680203-06:00","close_reason":"Closed","labels":["aspire","integration","testing"],"dependencies":[{"issue_id":"agent-ops-93m.7","depends_on_id":"agent-ops-93m","type":"parent-child","created_at":"2025-12-22T14:11:32.247476-06:00","created_by":"daemon"},{"issue_id":"agent-ops-93m.7","depends_on_id":"agent-ops-93m.4","type":"blocks","created_at":"2025-12-22T14:11:32.248899-06:00","created_by":"daemon"},{"issue_id":"agent-ops-93m.7","depends_on_id":"agent-ops-93m.5","type":"blocks","created_at":"2025-12-22T14:11:32.249591-06:00","created_by":"daemon"}]}
{"id":"agent-ops-avw","title":"Phase 4: Agent Integration","description":"Integrate Claude Agent SDK with agent manager service, trace/pause hooks, and built-in YAML templates for refiner, implementer, tester, and reviewer agents.","status":"closed","priority":3,"issue_type":"epic","created_at":"2025-12-20T22:44:00.166505-06:00","updated_at":"2025-12-24T11:01:51.424076-06:00","closed_at":"2025-12-24T11:01:51.424076-06:00","close_reason":"Superseded by agent-ops-4ka (provider-agnostic approach)","labels":["backend","claude-sdk"],"dependencies":[{"issue_id":"agent-ops-avw","depends_on_id":"agent-ops-7vk","type":"blocks","created_at":"2025-12-20T22:47:28.564613-06:00","created_by":"daemon"}]}
{"id":"agent-ops-avw.1","title":"Implement Agent manager service","description":"Create src/services/agent-manager.service.ts to spawn, manage, and terminate Claude Agent SDK instances with proper configuration from templates.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:46:03.948583-06:00","updated_at":"2025-12-23T20:18:50.46798-06:00","labels":["backend","claude-sdk","services"],"dependencies":[{"issue_id":"agent-ops-avw.1","depends_on_id":"agent-ops-avw","type":"parent-child","created_at":"2025-12-20T22:46:03.951174-06:00","created_by":"daemon"}]}
{"id":"agent-ops-avw.2","title":"Implement trace hook","description":"Create src/hooks/trace.hook.ts for Claude Agent SDK to capture tool calls, token usage, and state changes for observability.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:46:05.345262-06:00","updated_at":"2025-12-23T20:18:50.699891-06:00","labels":["backend","claude-sdk","hooks"],"dependencies":[{"issue_id":"agent-ops-avw.2","depends_on_id":"agent-ops-avw","type":"parent-child","created_at":"2025-12-20T22:46:05.348616-06:00","created_by":"daemon"}]}
{"id":"agent-ops-avw.3","title":"Implement pause hook","description":"Create src/hooks/pause.hook.ts for Claude Agent SDK to support pausing/resuming agent execution on demand.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:46:06.498876-06:00","updated_at":"2025-12-23T20:18:50.945405-06:00","labels":["backend","claude-sdk","hooks"],"dependencies":[{"issue_id":"agent-ops-avw.3","depends_on_id":"agent-ops-avw","type":"parent-child","created_at":"2025-12-20T22:46:06.501947-06:00","created_by":"daemon"}]}
{"id":"agent-ops-avw.4","title":"Create Refiner template YAML","description":"Create src/templates/refiner.yaml with system prompt, permission mode, and tools for spec refinement agent.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:46:07.817133-06:00","updated_at":"2025-12-23T20:18:51.186519-06:00","labels":["backend","templates"],"dependencies":[{"issue_id":"agent-ops-avw.4","depends_on_id":"agent-ops-avw","type":"parent-child","created_at":"2025-12-20T22:46:07.819773-06:00","created_by":"daemon"}]}
{"id":"agent-ops-avw.5","title":"Create Implementer template YAML","description":"Create src/templates/implementer.yaml with system prompt, permission mode (acceptEdits), and tools for code implementation agent.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:46:09.024097-06:00","updated_at":"2025-12-23T20:18:51.424916-06:00","labels":["backend","templates"],"dependencies":[{"issue_id":"agent-ops-avw.5","depends_on_id":"agent-ops-avw","type":"parent-child","created_at":"2025-12-20T22:46:09.027293-06:00","created_by":"daemon"}]}
{"id":"agent-ops-avw.6","title":"Create Tester template YAML","description":"Create src/templates/tester.yaml with system prompt, permission mode, and tools for QA testing agent.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:46:11.462785-06:00","updated_at":"2025-12-23T20:18:51.671139-06:00","labels":["backend","templates"],"dependencies":[{"issue_id":"agent-ops-avw.6","depends_on_id":"agent-ops-avw","type":"parent-child","created_at":"2025-12-20T22:46:11.465369-06:00","created_by":"daemon"}]}
{"id":"agent-ops-avw.7","title":"Create Reviewer template YAML","description":"Create src/templates/reviewer.yaml with system prompt, permission mode (askUser), and tools for code review agent.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:46:12.707073-06:00","updated_at":"2025-12-23T20:18:51.900021-06:00","labels":["backend","templates"],"dependencies":[{"issue_id":"agent-ops-avw.7","depends_on_id":"agent-ops-avw","type":"parent-child","created_at":"2025-12-20T22:46:12.709704-06:00","created_by":"daemon"}]}
{"id":"agent-ops-c8a","title":"Phase 2: Agent Runtime","description":"Execute Claude agents against codebases. Handle git operations, agent lifecycle, and work product collection. This is the core execution engine.","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-23T20:16:49.720807-06:00","updated_at":"2025-12-23T23:23:48.545493-06:00","closed_at":"2025-12-23T23:23:48.545493-06:00","close_reason":"Closed","labels":["agent","claude-sdk","runtime"]}
{"id":"agent-ops-c8a.1","title":"Git operations service","description":"Service for git operations: clone repo, create branch, stage changes, commit, push. Use simple-git or similar. Handle credentials securely.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-23T20:17:06.053527-06:00","updated_at":"2025-12-23T23:23:47.378336-06:00","closed_at":"2025-12-23T23:23:47.378336-06:00","close_reason":"Closed","labels":["agent","git"],"dependencies":[{"issue_id":"agent-ops-c8a.1","depends_on_id":"agent-ops-c8a","type":"parent-child","created_at":"2025-12-23T20:17:06.056471-06:00","created_by":"daemon"}]}
{"id":"agent-ops-c8a.2","title":"Claude SDK agent executor","description":"Integrate Claude Agent SDK to run agents against cloned repos. Configure agent with work item context, repo path, and tools. Capture agent output/traces.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-23T20:17:08.102399-06:00","updated_at":"2025-12-23T23:23:47.601911-06:00","closed_at":"2025-12-23T23:23:47.601911-06:00","close_reason":"Closed","labels":["agent","claude-sdk"],"dependencies":[{"issue_id":"agent-ops-c8a.2","depends_on_id":"agent-ops-c8a","type":"parent-child","created_at":"2025-12-23T20:17:08.104363-06:00","created_by":"daemon"}]}
{"id":"agent-ops-c8a.3","title":"Workspace manager","description":"Manage isolated workspaces for agent execution. Create temp directories, clone repos, cleanup after completion. Track workspace state and artifacts.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-23T20:17:10.148426-06:00","updated_at":"2025-12-23T23:23:47.864627-06:00","closed_at":"2025-12-23T23:23:47.864627-06:00","close_reason":"Closed","labels":["agent","workspace"],"dependencies":[{"issue_id":"agent-ops-c8a.3","depends_on_id":"agent-ops-c8a","type":"parent-child","created_at":"2025-12-23T20:17:10.149581-06:00","created_by":"daemon"}]}
{"id":"agent-ops-c8a.4","title":"Agent output collector","description":"Collect agent work products: file changes (diff), commit messages, PR description, execution logs. Store for review and PR creation.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-23T20:17:12.20479-06:00","updated_at":"2025-12-23T23:23:48.094517-06:00","closed_at":"2025-12-23T23:23:48.094517-06:00","close_reason":"Closed","labels":["agent","output"],"dependencies":[{"issue_id":"agent-ops-c8a.4","depends_on_id":"agent-ops-c8a","type":"parent-child","created_at":"2025-12-23T20:17:12.206396-06:00","created_by":"daemon"}]}
{"id":"agent-ops-c8a.5","title":"Agent lifecycle hooks","description":"Implement hooks for agent lifecycle: onStart, onToolUse, onPause, onComplete, onError. Enable monitoring and intervention points.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T20:17:14.164303-06:00","updated_at":"2025-12-23T23:23:48.320558-06:00","closed_at":"2025-12-23T23:23:48.320558-06:00","close_reason":"Closed","labels":["agent","hooks"],"dependencies":[{"issue_id":"agent-ops-c8a.5","depends_on_id":"agent-ops-c8a","type":"parent-child","created_at":"2025-12-23T20:17:14.166952-06:00","created_by":"daemon"}]}
{"id":"agent-ops-em3","title":"Phase 3: Orchestration","description":"Coordinate agent assignment, queue management, progress tracking, and error handling. Build on existing workflow engine and worker pool services.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-23T20:17:25.357741-06:00","updated_at":"2025-12-24T07:05:40.940432-06:00","closed_at":"2025-12-24T07:05:40.940432-06:00","close_reason":"Closed","labels":["orchestration","workflow"]}
{"id":"agent-ops-em3.1","title":"Work item queue manager","description":"Manage queue of work items ready for agent processing. Prioritization, deduplication, dependency ordering. Integrate with existing WorkItem service.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T20:17:41.392116-06:00","updated_at":"2025-12-24T00:53:40.807538-06:00","closed_at":"2025-12-24T00:53:40.807538-06:00","close_reason":"Closed","labels":["orchestration","queue"],"dependencies":[{"issue_id":"agent-ops-em3.1","depends_on_id":"agent-ops-em3","type":"parent-child","created_at":"2025-12-23T20:17:41.393348-06:00","created_by":"daemon"}]}
{"id":"agent-ops-em3.2","title":"Agent assignment logic","description":"Match work items to available agents based on: agent capabilities, workload, repo familiarity. Extend existing worker pool service.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T20:17:43.364299-06:00","updated_at":"2025-12-24T01:20:53.457269-06:00","closed_at":"2025-12-24T01:20:53.457269-06:00","close_reason":"Closed","labels":["assignment","orchestration"],"dependencies":[{"issue_id":"agent-ops-em3.2","depends_on_id":"agent-ops-em3","type":"parent-child","created_at":"2025-12-23T20:17:43.365453-06:00","created_by":"daemon"}]}
{"id":"agent-ops-em3.3","title":"Progress tracking","description":"Track agent progress on work items: started, in-progress milestones, blocked, completed, failed. Update WorkItem status, emit events for UI.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T20:17:46.829916-06:00","updated_at":"2025-12-24T01:49:58.303551-06:00","closed_at":"2025-12-24T01:49:58.303551-06:00","close_reason":"Closed","labels":["progress","status"],"dependencies":[{"issue_id":"agent-ops-em3.3","depends_on_id":"agent-ops-em3","type":"parent-child","created_at":"2025-12-23T20:17:46.83154-06:00","created_by":"daemon"}]}
{"id":"agent-ops-em3.4","title":"Error handling and retries","description":"Handle agent failures gracefully: categorize errors, implement retry logic with backoff, escalate persistent failures. Log for debugging.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T20:17:49.013126-06:00","updated_at":"2025-12-24T02:05:59.181636-06:00","closed_at":"2025-12-24T02:05:59.181636-06:00","close_reason":"Closed","labels":["errors","retry"],"dependencies":[{"issue_id":"agent-ops-em3.4","depends_on_id":"agent-ops-em3","type":"parent-child","created_at":"2025-12-23T20:17:49.014529-06:00","created_by":"daemon"}]}
{"id":"agent-ops-em3.5","title":"Concurrent agent limits","description":"Manage concurrent agent execution limits: per-repo, per-user, global. Prevent resource exhaustion and API rate limiting issues.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T20:17:51.129639-06:00","updated_at":"2025-12-24T02:27:52.021537-06:00","closed_at":"2025-12-24T02:27:52.021537-06:00","close_reason":"Closed","labels":["concurrency","limits"],"dependencies":[{"issue_id":"agent-ops-em3.5","depends_on_id":"agent-ops-em3","type":"parent-child","created_at":"2025-12-23T20:17:51.131206-06:00","created_by":"daemon"}]}
{"id":"agent-ops-kpr","title":"Phase 4: Visibility","description":"Minimal UI for monitoring agent work: status dashboard, execution logs, PR links. Keep it simple - focus on observability over interaction.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-23T20:18:01.517908-06:00","updated_at":"2025-12-24T11:01:51.228954-06:00","closed_at":"2025-12-24T11:01:51.228954-06:00","close_reason":"Superseded by agent-ops-4ka (Local Agent Dashboard MVP)","labels":["monitoring","ui","visibility"]}
{"id":"agent-ops-kpr.1","title":"Status dashboard","description":"Simple dashboard showing: connected repos, active agents, work items by status, recent completions. Real-time updates via existing WebSocket.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T20:18:15.370431-06:00","updated_at":"2025-12-24T14:45:25.799049-06:00","labels":["dashboard","ui"],"dependencies":[{"issue_id":"agent-ops-kpr.1","depends_on_id":"agent-ops-kpr","type":"parent-child","created_at":"2025-12-23T20:18:15.373286-06:00","created_by":"daemon"}]}
{"id":"agent-ops-kpr.2","title":"Execution log viewer","description":"View agent execution logs and traces. Show tool calls, decisions, errors. Link to OpenTelemetry traces in Aspire dashboard.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T20:18:17.001415-06:00","updated_at":"2025-12-24T14:45:27.281144-06:00","labels":["logs","ui"],"dependencies":[{"issue_id":"agent-ops-kpr.2","depends_on_id":"agent-ops-kpr","type":"parent-child","created_at":"2025-12-23T20:18:17.004958-06:00","created_by":"daemon"}]}
{"id":"agent-ops-kpr.3","title":"PR and issue links","description":"Display links to GitHub issues and PRs for each work item. Quick navigation between agent-ops and GitHub for review.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T20:18:19.281504-06:00","updated_at":"2025-12-24T14:45:28.552229-06:00","labels":["github","ui"],"dependencies":[{"issue_id":"agent-ops-kpr.3","depends_on_id":"agent-ops-kpr","type":"parent-child","created_at":"2025-12-23T20:18:19.282651-06:00","created_by":"daemon"}]}
{"id":"agent-ops-kpr.4","title":"Repo connection UI","description":"UI to connect GitHub repos: OAuth flow trigger, repo selection, sync configuration. Simple settings panel.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T20:18:21.354171-06:00","updated_at":"2025-12-24T14:45:29.930084-06:00","labels":["github","ui"],"dependencies":[{"issue_id":"agent-ops-kpr.4","depends_on_id":"agent-ops-kpr","type":"parent-child","created_at":"2025-12-23T20:18:21.355607-06:00","created_by":"daemon"}]}
{"id":"agent-ops-ll0","title":"Phase 3: API Routes","description":"Implement REST API endpoints and WebSocket hub for work items, templates, workers, metrics, and real-time events.","status":"open","priority":0,"issue_type":"epic","created_at":"2025-12-20T22:43:58.886066-06:00","updated_at":"2025-12-20T22:43:58.886066-06:00","labels":["api","backend"],"dependencies":[{"issue_id":"agent-ops-ll0","depends_on_id":"agent-ops-7vk","type":"blocks","created_at":"2025-12-20T22:47:28.345579-06:00","created_by":"daemon"}]}
{"id":"agent-ops-ll0.1","title":"Implement Work Items routes","description":"Create src/routes/work-items.routes.ts with REST endpoints: POST/GET/PATCH/DELETE /api/work-items, POST transition, POST assign.\n\n## Acceptance Criteria\n- [ ] POST /api/work-items returns 201 with created work item\n- [ ] POST /api/work-items returns 400 for invalid input  \n- [ ] GET /api/work-items returns 200 with array of work items\n- [ ] GET /api/work-items filters by status and type query params\n- [ ] GET /api/work-items/:id returns 200 with work item\n- [ ] GET /api/work-items/:id returns 404 for non-existent id\n- [ ] PATCH /api/work-items/:id returns 200 with updated work item\n- [ ] PATCH /api/work-items/:id returns 404 for non-existent id\n- [ ] DELETE /api/work-items/:id returns 204 on success\n- [ ] DELETE /api/work-items/:id returns 404 for non-existent id\n- [ ] DELETE /api/work-items/:id returns 400 when item has children\n- [ ] POST /api/work-items/:id/transition returns 200 with new status\n- [ ] POST /api/work-items/:id/transition returns 409 for invalid transition\n- [ ] POST /api/work-items/:id/assign returns 200 with assigned agent\n- [ ] POST /api/work-items/:id/success-criteria returns 200 with new criterion\n- [ ] All endpoints use Zod validation\n- [ ] ES module imports use .js extensions\n- [ ] All tests pass (npm test)\n\n## Implementation Plan\nSee rpi/001-work-items-routes/plan.md for detailed TDD implementation plan.","notes":"## Implementation Summary\n\nCreated `backend/src/routes/work-items.routes.ts` with 8 REST endpoints using Fastify plugin pattern.\n\n### Endpoints Implemented\n- `POST /api/work-items` - Create (201, 400)\n- `GET /api/work-items` - List with ?status/type filters (200)\n- `GET /api/work-items/:id` - Get by ID (200, 404)\n- `PATCH /api/work-items/:id` - Update (200, 404)\n- `DELETE /api/work-items/:id` - Delete (204, 400, 404)\n- `POST /api/work-items/:id/transition` - State machine (200, 400, 404, 409)\n- `POST /api/work-items/:id/assign` - Agent assignment (200, 400, 404)\n- `POST /api/work-items/:id/success-criteria` - Add criterion (200, 400, 404)\n\n### Key Patterns Established\n1. **Route Plugin Pattern**: Service injection via `WorkItemRoutesOptions`\n2. **Validation**: Zod schemas with 400 error responses\n3. **Error Handling**: Mapped service errors to HTTP status codes (404, 409)\n4. **Testing**: Integration tests using `app.inject()` with in-memory SQLite\n\n### Files Created/Modified\n- `backend/src/routes/work-items.routes.ts` (8.5KB) - Route handlers\n- `backend/src/routes/work-items.routes.test.ts` (17.9KB) - 30 tests\n- `backend/src/app.ts` - Added DB injection \u0026 route registration\n- `backend/src/index.ts` - Passes database to buildApp()\n\n### Verification\n- 610 tests passing\n- TypeScript compiles\n- All acceptance criteria met","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-20T22:45:32.595638-06:00","updated_at":"2025-12-23T19:46:28.772635-06:00","closed_at":"2025-12-23T19:46:28.772635-06:00","close_reason":"Closed","labels":["api","backend"],"dependencies":[{"issue_id":"agent-ops-ll0.1","depends_on_id":"agent-ops-ll0","type":"parent-child","created_at":"2025-12-20T22:45:32.596204-06:00","created_by":"daemon"}]}
{"id":"agent-ops-ll0.2","title":"Implement Templates routes","description":"Create src/routes/templates.routes.ts with REST endpoints: GET/POST/PATCH/DELETE /api/templates.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T22:45:33.52594-06:00","updated_at":"2025-12-23T20:18:53.952008-06:00","labels":["api","backend"],"dependencies":[{"issue_id":"agent-ops-ll0.2","depends_on_id":"agent-ops-ll0","type":"parent-child","created_at":"2025-12-20T22:45:33.530596-06:00","created_by":"daemon"}]}
{"id":"agent-ops-ll0.3","title":"Implement Workers routes","description":"Create src/routes/workers.routes.ts with REST endpoints: GET /api/workers, POST pause/resume/terminate/inject.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T22:45:35.547777-06:00","updated_at":"2025-12-23T20:18:54.258561-06:00","labels":["api","backend"],"dependencies":[{"issue_id":"agent-ops-ll0.3","depends_on_id":"agent-ops-ll0","type":"parent-child","created_at":"2025-12-20T22:45:35.550471-06:00","created_by":"daemon"}]}
{"id":"agent-ops-ll0.4","title":"Implement Metrics routes","description":"Create src/routes/metrics.routes.ts with endpoints: GET /api/metrics/agents, /api/metrics/work, /api/metrics/system, /api/traces.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:45:36.621931-06:00","updated_at":"2025-12-23T20:18:54.573535-06:00","labels":["api","backend"],"dependencies":[{"issue_id":"agent-ops-ll0.4","depends_on_id":"agent-ops-ll0","type":"parent-child","created_at":"2025-12-20T22:45:36.625312-06:00","created_by":"daemon"}]}
{"id":"agent-ops-ll0.5","title":"Implement Config routes","description":"Create src/routes/config.routes.ts with endpoints: GET/PATCH /api/config/workflow, GET/PATCH /api/config/pool.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:45:37.906312-06:00","updated_at":"2025-12-23T20:18:54.873868-06:00","labels":["api","backend"],"dependencies":[{"issue_id":"agent-ops-ll0.5","depends_on_id":"agent-ops-ll0","type":"parent-child","created_at":"2025-12-20T22:45:37.908739-06:00","created_by":"daemon"}]}
{"id":"agent-ops-ll0.6","title":"Implement WebSocket routes","description":"Create src/routes/ws.routes.ts for WebSocket connections handling ServerEvents and ClientCommands as specified in design doc.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T22:45:39.305161-06:00","updated_at":"2025-12-23T20:18:55.180025-06:00","labels":["api","backend","websocket"],"dependencies":[{"issue_id":"agent-ops-ll0.6","depends_on_id":"agent-ops-ll0","type":"parent-child","created_at":"2025-12-20T22:45:39.308028-06:00","created_by":"daemon"}]}
{"id":"agent-ops-tlv","title":"Phase 6: Polish","description":"Add unit and integration tests, Docker configuration, and documentation for production readiness.","status":"open","priority":3,"issue_type":"epic","created_at":"2025-12-20T22:44:02.485346-06:00","updated_at":"2025-12-23T20:18:57.121511-06:00","labels":["devops","testing"],"dependencies":[{"issue_id":"agent-ops-tlv","depends_on_id":"agent-ops-4yu","type":"blocks","created_at":"2025-12-20T22:47:29.003719-06:00","created_by":"daemon"}]}
{"id":"agent-ops-tlv.1","title":"Add backend unit tests","description":"Create unit tests for all services, repositories, and utility functions using Vitest.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:47:13.236481-06:00","updated_at":"2025-12-23T20:18:57.431055-06:00","labels":["backend","testing"],"dependencies":[{"issue_id":"agent-ops-tlv.1","depends_on_id":"agent-ops-tlv","type":"parent-child","created_at":"2025-12-20T22:47:13.239878-06:00","created_by":"daemon"}]}
{"id":"agent-ops-tlv.2","title":"Add backend integration tests","description":"Create integration tests for API endpoints using Fastify inject and test database.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:47:14.652367-06:00","updated_at":"2025-12-23T20:18:57.731262-06:00","labels":["backend","testing"],"dependencies":[{"issue_id":"agent-ops-tlv.2","depends_on_id":"agent-ops-tlv","type":"parent-child","created_at":"2025-12-20T22:47:14.655291-06:00","created_by":"daemon"}]}
{"id":"agent-ops-tlv.3","title":"Add frontend component tests","description":"Create component tests for key UI components using Vitest and React Testing Library.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:47:15.710388-06:00","updated_at":"2025-12-23T20:18:58.024913-06:00","labels":["frontend","testing"],"dependencies":[{"issue_id":"agent-ops-tlv.3","depends_on_id":"agent-ops-tlv","type":"parent-child","created_at":"2025-12-20T22:47:15.712877-06:00","created_by":"daemon"}]}
{"id":"agent-ops-tlv.4","title":"Create Docker configuration","description":"Create Dockerfile for backend and frontend, docker-compose.yml for local development with all services.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:47:16.99926-06:00","updated_at":"2025-12-23T20:18:58.334082-06:00","labels":["devops","docker"],"dependencies":[{"issue_id":"agent-ops-tlv.4","depends_on_id":"agent-ops-tlv","type":"parent-child","created_at":"2025-12-20T22:47:17.003535-06:00","created_by":"daemon"}]}
{"id":"agent-ops-tlv.5","title":"Add environment configuration","description":"Create .env.example files, document all environment variables, add validation on startup.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:47:18.153572-06:00","updated_at":"2025-12-23T20:18:58.680171-06:00","labels":["config","devops"],"dependencies":[{"issue_id":"agent-ops-tlv.5","depends_on_id":"agent-ops-tlv","type":"parent-child","created_at":"2025-12-20T22:47:18.156802-06:00","created_by":"daemon"}]}
{"id":"agent-ops-tlv.6","title":"Write README documentation","description":"Document setup instructions, architecture overview, API reference, and development workflow in README.md.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-20T22:47:19.462706-06:00","updated_at":"2025-12-23T20:18:59.047351-06:00","labels":["docs"],"dependencies":[{"issue_id":"agent-ops-tlv.6","depends_on_id":"agent-ops-tlv","type":"parent-child","created_at":"2025-12-20T22:47:19.465957-06:00","created_by":"daemon"}]}
{"id":"agent-ops-ug9","title":"Refactor to Vertical Slice Architecture","description":"Reorganize backend from layer-based architecture (routes/, services/, repositories/, models/) to feature-based vertical slices. Each feature should contain its own handlers, services, models, and tests in one place.\n\n**Current Structure:**\n- routes/ (10 files)\n- services/ (27 files)\n- repositories/ (14 files)\n- models/ (5 files)\n\n**Target Structure:**\n- features/\n  - agent-runtime/\n    - agent-runtime.handler.ts\n    - agent-runtime.service.ts\n    - agent-runtime.repository.ts\n    - agent-runtime.test.ts\n  - work-items/\n  - github-webhooks/\n  - pull-requests/\n  - concurrency/\n  - repositories/\n  - ...\n- shared/ (cross-cutting: db, telemetry, config)\n\n**Benefits:**\n- Related code together - easier to understand features\n- Easier to modify and delete features\n- Better encapsulation and boundaries\n- Reduced coupling between features","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-24T07:57:46.347393-06:00","updated_at":"2025-12-24T11:01:01.400413-06:00","closed_at":"2025-12-24T11:01:01.400413-06:00","close_reason":"Closed"}
{"id":"agent-ops-ug9.1","title":"Slice: agent-runtime feature","description":"Move agent runtime files into features/agent-runtime/:\n- routes/agent-runtime.routes.ts → handler\n- services/agent-executor.service.ts\n- services/agent-lifecycle.service.ts  \n- services/agent-output-collector.service.ts\n- repositories/agent-execution.repository.ts\n- All related tests","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T08:03:27.79535-06:00","updated_at":"2025-12-24T08:31:49.391353-06:00","closed_at":"2025-12-24T08:31:49.391353-06:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-ops-ug9.1","depends_on_id":"agent-ops-ug9","type":"parent-child","created_at":"2025-12-24T08:03:27.798596-06:00","created_by":"daemon"}]}
{"id":"agent-ops-ug9.10","title":"Slice: orchestration feature","description":"Move orchestration files into features/orchestration/:\n- services/orchestration.service.ts\n- services/workflow-engine.service.ts\n- All related tests","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T08:04:01.129756-06:00","updated_at":"2025-12-24T10:09:58.075206-06:00","closed_at":"2025-12-24T10:09:58.075206-06:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-ops-ug9.10","depends_on_id":"agent-ops-ug9","type":"parent-child","created_at":"2025-12-24T08:04:01.132569-06:00","created_by":"daemon"}]}
{"id":"agent-ops-ug9.11","title":"Extract shared infrastructure","description":"Move cross-cutting concerns into shared/:\n- db/ → shared/db/\n- config.ts → shared/config.ts\n- telemetry.ts → shared/telemetry.ts\n- services/observability.service.ts → shared/observability/\n- services/websocket-hub.service.ts → shared/websocket/\n- services/git-operations.service.ts → shared/git/\n- models/trace.ts → shared/telemetry/\n\nUpdate all imports across features.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T08:04:04.159849-06:00","updated_at":"2025-12-24T10:23:34.285764-06:00","closed_at":"2025-12-24T10:23:34.285764-06:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-ops-ug9.11","depends_on_id":"agent-ops-ug9","type":"parent-child","created_at":"2025-12-24T08:04:04.163238-06:00","created_by":"daemon"}]}
{"id":"agent-ops-ug9.12","title":"Clean up old layer directories","description":"After all slices are migrated:\n- Remove empty routes/, services/, repositories/, models/ directories\n- Update app.ts to import from features/\n- Update any remaining imports\n- Run full test suite to verify","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T08:04:12.582571-06:00","updated_at":"2025-12-24T10:29:13.601837-06:00","closed_at":"2025-12-24T10:29:13.601837-06:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-ops-ug9.12","depends_on_id":"agent-ops-ug9","type":"parent-child","created_at":"2025-12-24T08:04:12.585583-06:00","created_by":"daemon"}]}
{"id":"agent-ops-ug9.2","title":"Slice: work-items feature","description":"Move work items files into features/work-items/:\n- routes/work-items.routes.ts → handler\n- services/work-item.service.ts\n- repositories/work-item.repository.ts\n- models/work-item.ts\n- All related tests","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T08:03:29.86281-06:00","updated_at":"2025-12-24T08:45:46.060747-06:00","closed_at":"2025-12-24T08:45:46.060747-06:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-ops-ug9.2","depends_on_id":"agent-ops-ug9","type":"parent-child","created_at":"2025-12-24T08:03:29.86592-06:00","created_by":"daemon"}]}
{"id":"agent-ops-ug9.3","title":"Slice: github-integration feature","description":"Move GitHub integration files into features/github/:\n- routes/github-auth.routes.ts → handler\n- routes/github-webhook.routes.ts → handler\n- services/github.service.ts\n- services/github-webhook.service.ts\n- services/github-sync.service.ts\n- repositories/github-connection.repository.ts\n- All related tests","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T08:03:32.811491-06:00","updated_at":"2025-12-24T09:12:49.79525-06:00","closed_at":"2025-12-24T09:12:49.79525-06:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-ops-ug9.3","depends_on_id":"agent-ops-ug9","type":"parent-child","created_at":"2025-12-24T08:03:32.814041-06:00","created_by":"daemon"}]}
{"id":"agent-ops-ug9.4","title":"Slice: pull-requests feature","description":"Move pull requests files into features/pull-requests/:\n- routes/pull-requests.routes.ts → handler\n- services/github-pr.service.ts\n- All related tests","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T08:03:34.773565-06:00","updated_at":"2025-12-24T09:23:51.005108-06:00","closed_at":"2025-12-24T09:23:51.005108-06:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-ops-ug9.4","depends_on_id":"agent-ops-ug9","type":"parent-child","created_at":"2025-12-24T08:03:34.777103-06:00","created_by":"daemon"}]}
{"id":"agent-ops-ug9.5","title":"Slice: concurrency feature","description":"Move concurrency files into features/concurrency/:\n- routes/concurrency.routes.ts → handler\n- All related tests","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T08:03:36.682741-06:00","updated_at":"2025-12-24T09:28:43.741045-06:00","closed_at":"2025-12-24T09:28:43.741045-06:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-ops-ug9.5","depends_on_id":"agent-ops-ug9","type":"parent-child","created_at":"2025-12-24T08:03:36.685942-06:00","created_by":"daemon"}]}
{"id":"agent-ops-ug9.6","title":"Slice: repositories feature","description":"Move repository management files into features/repositories/:\n- routes/repositories.routes.ts → handler\n- repositories/repository.repository.ts\n- All related tests","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T08:03:38.805274-06:00","updated_at":"2025-12-24T09:36:54.19439-06:00","closed_at":"2025-12-24T09:36:54.19439-06:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-ops-ug9.6","depends_on_id":"agent-ops-ug9","type":"parent-child","created_at":"2025-12-24T08:03:38.80839-06:00","created_by":"daemon"}]}
{"id":"agent-ops-ug9.7","title":"Slice: templates feature","description":"Move template files into features/templates/:\n- services/template-registry.service.ts\n- repositories/template.repository.ts\n- models/template.ts\n- All related tests","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T08:03:55.925539-06:00","updated_at":"2025-12-24T09:43:19.433498-06:00","closed_at":"2025-12-24T09:43:19.433498-06:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-ops-ug9.7","depends_on_id":"agent-ops-ug9","type":"parent-child","created_at":"2025-12-24T08:03:55.927191-06:00","created_by":"daemon"}]}
{"id":"agent-ops-ug9.8","title":"Slice: workers feature","description":"Move worker pool files into features/workers/:\n- services/worker-pool.service.ts\n- repositories/worker.repository.ts\n- models/worker.ts\n- All related tests","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T08:03:57.756719-06:00","updated_at":"2025-12-24T09:55:33.217821-06:00","closed_at":"2025-12-24T09:55:33.217821-06:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-ops-ug9.8","depends_on_id":"agent-ops-ug9","type":"parent-child","created_at":"2025-12-24T08:03:57.759411-06:00","created_by":"daemon"}]}
{"id":"agent-ops-ug9.9","title":"Slice: workspaces feature","description":"Move workspace files into features/workspaces/:\n- services/workspace-manager.service.ts\n- repositories/workspace.repository.ts\n- All related tests","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T08:03:59.577803-06:00","updated_at":"2025-12-24T10:00:29.811555-06:00","closed_at":"2025-12-24T10:00:29.811555-06:00","close_reason":"Closed","dependencies":[{"issue_id":"agent-ops-ug9.9","depends_on_id":"agent-ops-ug9","type":"parent-child","created_at":"2025-12-24T08:03:59.578874-06:00","created_by":"daemon"}]}
{"id":"agent-ops-zi0","title":"Phase 1: GitHub Integration","description":"Connect to GitHub repos, sync issues as work items, and create PRs from agent work. This is the foundation for the agent-driven development loop.","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-23T20:16:14.260233-06:00","updated_at":"2025-12-23T22:26:55.769697-06:00","closed_at":"2025-12-23T22:26:55.769697-06:00","close_reason":"Closed","labels":["github","integration"]}
{"id":"agent-ops-zi0.1","title":"GitHub OAuth flow","description":"Implement GitHub OAuth for user authentication and repo access. Store tokens securely. Support both personal and organization repos.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-23T20:16:29.448101-06:00","updated_at":"2025-12-23T22:16:36.413059-06:00","closed_at":"2025-12-23T22:16:36.413059-06:00","close_reason":"Closed","labels":["auth","github"],"dependencies":[{"issue_id":"agent-ops-zi0.1","depends_on_id":"agent-ops-zi0","type":"parent-child","created_at":"2025-12-23T20:16:29.451603-06:00","created_by":"daemon"}]}
{"id":"agent-ops-zi0.2","title":"Repository connection model","description":"Create Zod schema and Drizzle model for connected repositories. Track: repo URL, owner, name, default branch, access token reference, sync status.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-23T20:16:31.504158-06:00","updated_at":"2025-12-23T22:22:06.107364-06:00","closed_at":"2025-12-23T22:22:06.107364-06:00","close_reason":"Closed","labels":["github","models"],"dependencies":[{"issue_id":"agent-ops-zi0.2","depends_on_id":"agent-ops-zi0","type":"parent-child","created_at":"2025-12-23T20:16:31.506669-06:00","created_by":"daemon"}]}
{"id":"agent-ops-zi0.3","title":"GitHub Issues sync","description":"Sync GitHub Issues to internal WorkItems. Support: initial import, webhook updates, bi-directional status sync. Map labels/assignees appropriately.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-23T20:16:33.607277-06:00","updated_at":"2025-12-23T22:24:27.875243-06:00","closed_at":"2025-12-23T22:24:27.875243-06:00","close_reason":"Closed","labels":["github","sync"],"dependencies":[{"issue_id":"agent-ops-zi0.3","depends_on_id":"agent-ops-zi0","type":"parent-child","created_at":"2025-12-23T20:16:33.608248-06:00","created_by":"daemon"}]}
{"id":"agent-ops-zi0.4","title":"Pull Request creation","description":"Create PRs from agent work. Include: branch creation, commit attribution, PR description with context, link back to originating issue.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-23T20:16:35.813673-06:00","updated_at":"2025-12-23T22:26:54.615441-06:00","closed_at":"2025-12-23T22:26:54.615441-06:00","close_reason":"Closed","labels":["github","pr"],"dependencies":[{"issue_id":"agent-ops-zi0.4","depends_on_id":"agent-ops-zi0","type":"parent-child","created_at":"2025-12-23T20:16:35.815205-06:00","created_by":"daemon"}]}
{"id":"agent-ops-zi0.5","title":"GitHub webhooks handler","description":"Handle GitHub webhooks for real-time updates: issue created/updated/closed, PR merged/closed, comments. Verify webhook signatures.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T20:16:38.59567-06:00","updated_at":"2025-12-24T07:24:53.989731-06:00","closed_at":"2025-12-24T07:24:53.989731-06:00","close_reason":"Closed","labels":["github","webhooks"],"dependencies":[{"issue_id":"agent-ops-zi0.5","depends_on_id":"agent-ops-zi0","type":"parent-child","created_at":"2025-12-23T20:16:38.597795-06:00","created_by":"daemon"}]}
